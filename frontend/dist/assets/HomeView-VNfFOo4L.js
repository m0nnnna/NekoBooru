import{d as D,r as u,c as U,a as _,_ as N,b as G,e as O,o as g,w as M,f as s,g as m,h as C,F as E,i as R,n as x,j as H,u as J,k as A,l as j,t as L,m as $,v as I,p as B,q as K}from"./index-CMYoRPze.js";import{P as Q}from"./Pagination-CraLoTXc.js";const T=D("posts",()=>{const o=u([]),n=u(null),d=u(0),i=u(1),f=u(40),p=u(""),r=u(!1),v=u(null),V=U(()=>Math.ceil(d.value/f.value));async function c(l={}){r.value=!0,v.value=null;try{const t=await _.getPosts({q:p.value,page:i.value,limit:f.value,...l});o.value=t.results,d.value=t.total}catch(t){v.value=t.message}finally{r.value=!1}}async function F(l){r.value=!0,v.value=null;try{n.value=await _.getPost(l)}catch(t){v.value=t.message}finally{r.value=!1}}async function P(l,t){var e;try{const a=await _.updatePost(l,t);((e=n.value)==null?void 0:e.id)===l&&(n.value=a);const b=o.value.findIndex(h=>h.id===l);return b!==-1&&(o.value[b]=a),a}catch(a){throw v.value=a.message,a}}async function S(l){var t;try{await _.deletePost(l),o.value=o.value.filter(e=>e.id!==l),((t=n.value)==null?void 0:t.id)===l&&(n.value=null)}catch(e){throw v.value=e.message,e}}async function k(l){var t;try{const e=await _.toggleFavorite(l);((t=n.value)==null?void 0:t.id)===l&&(n.value.isFavorited=e.isFavorited);const a=o.value.find(b=>b.id===l);return a&&(a.isFavorited=e.isFavorited),e.isFavorited}catch(e){throw v.value=e.message,e}}function y(l){p.value=l,i.value=1}function q(l){i.value=l}return{posts:o,currentPost:n,total:d,page:i,limit:f,pages:V,query:p,loading:r,error:v,fetchPosts:c,fetchPost:F,updatePost:P,deletePost:S,toggleFavorite:k,setQuery:y,setPage:q}}),W={class:"thumb-container"},X=["src","alt"],Y={key:0,class:"badge video-badge"},Z={key:1,class:"badge gif-badge"},ee={key:2,class:"badge fav-badge"},te={__name:"PostCard",props:{post:{type:Object,required:!0}},setup(o){const n=o,d=U(()=>[".webm",".mp4"].includes(n.post.extension)),i=U(()=>n.post.extension===".gif");function f(p){p.target.style.opacity="0.5"}return(p,r)=>{const v=G("router-link");return g(),O(v,{to:`/post/${o.post.id}`,class:"post-card"},{default:M(()=>[s("div",W,[s("img",{src:o.post.thumbUrl,alt:o.post.filename,loading:"lazy",onError:f},null,40,X),d.value?(g(),m("div",Y,"â–º")):C("",!0),i.value?(g(),m("div",Z,"GIF")):C("",!0),o.post.isFavorited?(g(),m("div",ee,"â™¥")):C("",!0)])]),_:1},8,["to"])}}},se=N(te,[["__scopeId","data-v-e59e5423"]]),ae={key:0,class:"empty-state"},oe={key:1,class:"loading-state"},le={__name:"PostGrid",props:{posts:{type:Array,required:!0},loading:{type:Boolean,default:!1}},emits:["select"],setup(o){return(n,d)=>(g(),m("div",{class:x(["post-grid",{"is-loading":o.loading&&o.posts.length>0}])},[(g(!0),m(E,null,R(o.posts,i=>(g(),O(se,{key:i.id,post:i,onClick:f=>n.$emit("select",i)},null,8,["post","onClick"]))),128)),o.posts.length===0&&!o.loading?(g(),m("div",ae,[...d[0]||(d[0]=[s("div",{class:"neko-face"},"(=^Â·Ë˜Â·^=)",-1),s("div",null,"No posts found, nyaa~",-1)])])):C("",!0),o.loading&&o.posts.length===0?(g(),m("div",oe,[...d[1]||(d[1]=[s("div",{class:"neko-loading"},[s("span",null,"ðŸ¾"),s("span",null,"ðŸ¾"),s("span",null,"ðŸ¾")],-1),s("div",null,"Fetching posts...",-1)])])):C("",!0)],2))}},ne=N(le,[["__scopeId","data-v-67dfecf7"]]),ue={class:"home-view"},ie={class:"toolbar"},re={class:"result-count"},ce={class:"toolbar-controls"},de={class:"safety-filter"},ve={class:"sort-controls"},fe={__name:"HomeView",setup(o){const n=J(),d=K(),i=T(),f=u("date"),p=u("desc"),r=u(1),v={safe:!0,sketchy:!0,unsafe:!0};function V(){try{const t=localStorage.getItem("safetyFilter");if(t){const e=JSON.parse(t);if(typeof e=="object"&&"safe"in e)return e}}catch{}return{...v}}const c=u(V()),F=u([]),P=u(0),S=u(0),k=u(!1);H(()=>{n.query.q&&i.setQuery(n.query.q),n.query.page&&(r.value=parseInt(n.query.page)||1),y()}),A(()=>n.query,t=>{t.q!==i.query&&i.setQuery(t.q||""),t.page?r.value=parseInt(t.page)||1:r.value=1,y()});async function y(){k.value=!0;try{let t=i.query;const{safe:e,sketchy:a,unsafe:b}=c.value,h=[];e||h.push("-safety:safe"),a||h.push("-safety:sketchy"),b||h.push("-safety:unsafe"),h.length>0&&(t=t?`${t} ${h.join(" ")}`:h.join(" "));const w=await fetch(`/api/posts?q=${encodeURIComponent(t)}&page=${r.value}&sort=${f.value}&order=${p.value}`).then(z=>z.json());F.value=w.results,P.value=w.total,S.value=w.pages}catch(t){console.error("Failed to fetch posts:",t)}finally{k.value=!1}}function q(){localStorage.setItem("safetyFilter",JSON.stringify(c.value)),r.value=1,y()}function l(t){r.value=t,d.push({query:{...n.query,page:t>1?t:void 0}}),y()}return(t,e)=>(g(),m("div",ue,[s("div",ie,[s("div",re,[s("span",{class:x({"loading-fade":k.value})},L(P.value)+" posts found",3)]),s("div",ce,[s("div",de,[s("label",{class:x(["safety-checkbox safe",{active:c.value.safe}]),title:"Safe"},[$(s("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=a=>c.value.safe=a),onChange:q},null,544),[[I,c.value.safe]])],2),s("label",{class:x(["safety-checkbox sketchy",{active:c.value.sketchy}]),title:"Sketchy"},[$(s("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=a=>c.value.sketchy=a),onChange:q},null,544),[[I,c.value.sketchy]])],2),s("label",{class:x(["safety-checkbox unsafe",{active:c.value.unsafe}]),title:"Unsafe"},[$(s("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=a=>c.value.unsafe=a),onChange:q},null,544),[[I,c.value.unsafe]])],2)]),s("div",ve,[$(s("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>f.value=a),onChange:y},[...e[6]||(e[6]=[s("option",{value:"date"},"Date",-1),s("option",{value:"id"},"ID",-1),s("option",{value:"size"},"Size",-1)])],544),[[B,f.value]]),$(s("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>p.value=a),onChange:y},[...e[7]||(e[7]=[s("option",{value:"desc"},"Newest first",-1),s("option",{value:"asc"},"Oldest first",-1)])],544),[[B,p.value]])])])]),j(ne,{posts:F.value,loading:k.value},null,8,["posts","loading"]),j(Q,{modelValue:r.value,"onUpdate:modelValue":[e[5]||(e[5]=a=>r.value=a),l],pages:S.value},null,8,["modelValue","pages"])]))}},ye=N(fe,[["__scopeId","data-v-9a884bb8"]]);export{ye as default};
