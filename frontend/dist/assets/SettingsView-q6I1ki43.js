import{_ as k,r as v,j as S,a as f,g as u,f as t,h as p,m as C,z as x,y as m,t as a,A as M,o as d}from"./index-BkOaPNou.js";const N={class:"settings-view"},V={class:"settings-section"},A={class:"form-group"},B={class:"path-input-group"},F={class:"help-text"},T={key:0,class:"migration-prompt"},P={class:"alert alert-warning"},q={class:"migration-info"},z={key:0,class:"migration-details"},E={key:0},I={key:1},L={class:"form-actions"},R=["disabled"],U={class:"settings-section"},W={class:"info-grid"},j={class:"info-item"},Y={class:"info-item"},G={class:"info-item"},H={class:"info-item"},J={__name:"SettingsView",setup(K){const o=v({}),n=v(""),c=v(!1),_=v(navigator.platform.toLowerCase().includes("win")),r=v({show:!1,old_path:"",new_path:""}),s=v({show:!1,success:!1,message:"",details:null});S(async()=>{await g()});async function g(){try{o.value=await f.getSettings(),n.value=o.value.data_dir||""}catch(i){alert("Failed to load settings: "+i.message)}}async function w(){if(!n.value.trim()){alert("Please enter a data directory path");return}c.value=!0,r.show=!1,s.show=!1;try{const i=await f.updateDataDir(n.value.trim(),!1);i.needs_migration?r.value={show:!0,old_path:i.old_path,new_path:i.new_path}:(await g(),alert("Settings saved successfully!"))}catch(i){alert("Failed to save settings: "+i.message)}finally{c.value=!1}}async function y(){var i,e;c.value=!0,r.show=!1;try{const l=await f.updateDataDir(n.value.trim(),!0);s.value={show:!0,success:l.success||!1,message:l.message||(l.success?"Migration completed successfully":"Migration failed"),details:l.migration||null,files_copied:(i=l.migration)==null?void 0:i.files_copied,directories_copied:(e=l.migration)==null?void 0:e.directories_copied},l.success&&(await g(),setTimeout(()=>{window.location.reload()},2e3))}catch(l){s.value={show:!0,success:!1,message:"Migration failed: "+l.message,details:null}}finally{c.value=!1}}function h(){r.show=!1,n.value=o.value.data_dir||""}function b(){n.value=o.value.data_dir||"",r.show=!1,s.show=!1}function D(){alert("Directory browsing requires a native file picker. Please enter the path manually.")}return(i,e)=>(d(),u("div",N,[e[16]||(e[16]=t("h1",null,"Settings",-1)),t("div",V,[e[9]||(e[9]=t("h2",null,"Data Storage",-1)),e[10]||(e[10]=t("p",{class:"section-description"}," Configure where NekoBooru stores your data (posts, thumbnails, database). Changing this location will migrate your existing data. ",-1)),t("div",A,[e[2]||(e[2]=t("label",null,"Data Directory",-1)),t("div",B,[C(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>n.value=l),type:"text",placeholder:"Enter data directory path",class:"path-input"},null,512),[[x,n.value]]),_.value?p("",!0):(d(),u("button",{key:0,class:"btn btn-secondary",onClick:D}," Browse "))]),t("p",F,[e[1]||(e[1]=m(" Current: ",-1)),t("code",null,a(o.value.data_dir||"Loading..."),1)])]),r.value.show?(d(),u("div",T,[t("div",P,[e[7]||(e[7]=t("strong",null,"⚠️ Data Migration Required",-1)),e[8]||(e[8]=t("p",null," Data exists at the old location. Would you like to migrate it to the new location? ",-1)),t("div",q,[t("p",null,[e[3]||(e[3]=t("strong",null,"From:",-1)),e[4]||(e[4]=m()),t("code",null,a(r.value.old_path),1)]),t("p",null,[e[5]||(e[5]=t("strong",null,"To:",-1)),e[6]||(e[6]=m()),t("code",null,a(r.value.new_path),1)])]),t("div",{class:"migration-actions"},[t("button",{class:"btn",onClick:y},"Yes, Migrate Data"),t("button",{class:"btn btn-secondary",onClick:h},"Cancel")])])])):p("",!0),s.value.show?(d(),u("div",{key:1,class:M(["migration-status",s.value.success?"success":"error"])},[t("p",null,[t("strong",null,a(s.value.success?"✓":"✗")+" "+a(s.value.message),1)]),s.value.details?(d(),u("div",z,[s.value.files_copied!==void 0?(d(),u("p",E," Files copied: "+a(s.value.files_copied),1)):p("",!0),s.value.directories_copied!==void 0?(d(),u("p",I," Directories copied: "+a(s.value.directories_copied),1)):p("",!0)])):p("",!0)],2)):p("",!0),t("div",L,[t("button",{class:"btn",onClick:w,disabled:!n.value.trim()||c.value},a(c.value?"Saving...":"Save Settings"),9,R),t("button",{class:"btn btn-secondary",onClick:b},"Reset")])]),t("div",U,[e[15]||(e[15]=t("h2",null,"Directory Information",-1)),t("div",W,[t("div",j,[e[11]||(e[11]=t("label",null,"Database",-1)),t("code",null,a(o.value.database_path||"N/A"),1)]),t("div",Y,[e[12]||(e[12]=t("label",null,"Posts",-1)),t("code",null,a(o.value.posts_dir||"N/A"),1)]),t("div",G,[e[13]||(e[13]=t("label",null,"Thumbnails",-1)),t("code",null,a(o.value.thumbs_dir||"N/A"),1)]),t("div",H,[e[14]||(e[14]=t("label",null,"Uploads",-1)),t("code",null,a(o.value.uploads_dir||"N/A"),1)])])])]))}},Q=k(J,[["__scopeId","data-v-ac7626a0"]]);export{Q as default};
