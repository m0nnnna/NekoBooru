import{_ as x,r as p,B as M,c as b,g as a,f as t,h as m,s as w,A as _,q as N,t as u,F as R,i as q,a as U,n as B,o as n,l as W,m as z,v as G,y}from"./index-CNhSW5AA.js";import{T as L}from"./TagInput-B3XNFdqG.js";const E={class:"upload-view"},J={class:"progress-bar"},Q={class:"progress-text"},j={key:0},H={key:1},K={key:1,class:"upload-queue"},O={class:"queue-header"},X={class:"queue-actions"},Y=["disabled"],Z=["disabled"],ee={class:"upload-list"},se={class:"preview"},te=["src"],oe={key:1,class:"no-preview"},le={class:"upload-details"},ae={class:"filename"},ne={class:"safety-row"},ie=["onUpdate:modelValue","disabled"],re={class:"upload-status"},de={key:0,class:"status uploading"},ue={key:1,class:"status completed"},ce={key:2,class:"status error"},pe=["onClick"],fe={key:2,class:"toast success"},ve={__name:"UploadView",setup(ge){B();const f=p(!1),i=p([]),c=p(!1),v=p(!1),h=p("");let V=0;const o=M({current:0,total:0,done:!1}),g=b(()=>i.value.filter(l=>!l.completed&&!l.error).length),C=b(()=>o.total===0?0:Math.round(o.current/o.total*100));function A(l){return l.type.startsWith("video/")?"&#9658;":"?"}function D(l){f.value=!1;const s=Array.from(l.dataTransfer.files);k(s)}function T(l){const s=Array.from(l.target.files);k(s),l.target.value=""}function k(l){for(const s of l){const e={id:++V,file:s,tags:[],safety:"safe",preview:null,uploading:!1,completed:!1,error:null};if(s.type.startsWith("image/")){const d=new FileReader;d.onload=r=>{e.preview=r.target.result},d.readAsDataURL(s)}i.value.push(e)}}function S(l){i.value.splice(l,1)}function F(){i.value=[],o.total=0,o.current=0,o.done=!1}function I(l){h.value=l,v.value=!0,setTimeout(()=>{v.value=!1},3e3)}async function $(){c.value=!0;const l=i.value.filter(e=>!e.completed&&!e.error);o.total=l.length,o.current=0,o.done=!1;let s=0;for(const e of l){e.uploading=!0,o.current++;try{const{token:d}=await U.uploadFile(e.file);await U.createPost({contentToken:d,tags:e.tags,safety:e.safety}),e.completed=!0,s++,setTimeout(()=>{const r=i.value.findIndex(P=>P.id===e.id);r!==-1&&i.value[r].completed&&i.value.splice(r,1)},1500)}catch(d){e.error=d.message}finally{e.uploading=!1}}c.value=!1,o.done=!0,s>0&&I(`Successfully uploaded ${s} file${s>1?"s":""}!`),setTimeout(()=>{o.done&&(o.total=0,o.current=0,o.done=!1)},3e3)}return(l,s)=>(n(),a("div",E,[s[9]||(s[9]=t("h1",null,"Upload",-1)),t("div",{class:_(["drop-zone",{dragging:f.value}]),onDragover:s[0]||(s[0]=w(e=>f.value=!0,["prevent"])),onDragleave:s[1]||(s[1]=e=>f.value=!1),onDrop:w(D,["prevent"]),onClick:s[2]||(s[2]=e=>l.$refs.fileInput.click())},[t("input",{ref:"fileInput",type:"file",multiple:"",accept:"image/*,video/webm,video/mp4",onChange:T,style:{display:"none"}},null,544),s[3]||(s[3]=t("div",{class:"drop-content"},[t("span",{class:"drop-icon"},"+"),t("p",null,"Drop files here or click to browse"),t("p",{class:"hint"},"Supported: JPG, PNG, GIF, WebP, WebM, MP4")],-1))],34),o.total>0?(n(),a("div",{key:0,class:_(["progress-banner",{done:o.done}])},[t("div",J,[t("div",{class:"progress-fill",style:N({width:C.value+"%"})},null,4)]),t("div",Q,[o.done?(n(),a("span",j,"All uploads complete!")):(n(),a("span",H,"Uploading "+u(o.current)+" of "+u(o.total)+"...",1))])],2)):m("",!0),i.value.length>0?(n(),a("div",K,[t("div",O,[t("h2",null,"Queue ("+u(g.value)+" pending)",1),t("div",X,[t("button",{class:"btn btn-secondary",onClick:F,disabled:c.value}," Clear All ",8,Y),t("button",{class:"btn",onClick:$,disabled:c.value||g.value===0},u(c.value?"Uploading...":`Upload All (${g.value})`),9,Z)])]),t("div",ee,[(n(!0),a(R,null,q(i.value,(e,d)=>(n(),a("div",{key:e.id,class:_(["upload-item",{completed:e.completed,error:e.error,uploading:e.uploading}])},[t("div",se,[e.preview?(n(),a("img",{key:0,src:e.preview},null,8,te)):(n(),a("span",oe,u(A(e.file)),1))]),t("div",le,[t("div",ae,u(e.file.name),1),W(L,{modelValue:e.tags,"onUpdate:modelValue":r=>e.tags=r,placeholder:"Add tags (comma separated)...",disabled:e.completed||e.uploading},null,8,["modelValue","onUpdate:modelValue","disabled"]),t("div",ne,[s[5]||(s[5]=t("label",null,"Rating:",-1)),z(t("select",{"onUpdate:modelValue":r=>e.safety=r,disabled:e.completed||e.uploading},[...s[4]||(s[4]=[t("option",{value:"safe"},"Safe",-1),t("option",{value:"sketchy"},"Sketchy",-1),t("option",{value:"unsafe"},"Unsafe",-1)])],8,ie),[[G,e.safety]])])]),t("div",re,[e.uploading?(n(),a("div",de,[...s[6]||(s[6]=[t("span",{class:"spinner"},null,-1),y(" Uploading... ",-1)])])):e.completed?(n(),a("div",ue,[...s[7]||(s[7]=[t("span",{class:"checkmark"},"✓",-1),y(" Done! ",-1)])])):e.error?(n(),a("div",ce,[s[8]||(s[8]=t("span",{class:"error-icon"},"✗",-1)),y(" "+u(e.error),1)])):(n(),a("button",{key:3,class:"btn btn-secondary btn-sm",onClick:r=>S(d)}," Remove ",8,pe))])],2))),128))])])):m("",!0),v.value?(n(),a("div",fe,u(h.value),1)):m("",!0)]))}},ye=x(ve,[["__scopeId","data-v-f91cc765"]]);export{ye as default};
