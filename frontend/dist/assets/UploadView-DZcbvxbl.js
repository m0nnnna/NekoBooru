import{_ as B,r as p,j as G,s as H,a as k,C as w,c as V,g as n,f as o,h as U,y as I,n as D,x as J,t as c,F as Q,i as X,q as K,o as l,l as O,m as Y,p as Z,A as F}from"./index-DLPz7a8K.js";import{T as ee}from"./TagInput-wzFLzK80.js";const te={class:"upload-view"},se={class:"drop-content"},oe={key:0,class:"drop-icon spinner-icon"},ae={key:1,class:"drop-icon"},ne={key:2},le={key:3},ie={class:"progress-bar"},re={class:"progress-text"},de={key:0},ce={key:1},ue={key:1,class:"upload-queue"},pe={class:"queue-header"},fe={class:"queue-actions"},me=["disabled"],ve=["disabled"],ge={class:"upload-list"},ye={class:"preview"},he=["src"],_e={key:1,class:"no-preview"},be={class:"upload-details"},ke={class:"filename"},we={class:"safety-row"},Ue=["onUpdate:modelValue","disabled"],De={class:"upload-status"},Fe={key:0,class:"status uploading"},xe={key:1,class:"status completed"},Ae={key:2,class:"status error"},Ce=["onClick"],Te={key:2,class:"toast success"},Ve={__name:"UploadView",setup(Ie){K();const g=p(!1),d=p([]),f=p(!1),_=p(!1),x=p(""),m=p(!1);let A=0;G(()=>{document.addEventListener("paste",C)}),H(()=>{document.removeEventListener("paste",C)});async function C(s){var v;const t=document.activeElement;if(t&&(t.tagName==="INPUT"||t.tagName==="TEXTAREA"))return;const e=s.clipboardData;if(!e)return;const r=Array.from(e.files);if(r.length>0){s.preventDefault(),y(r);return}for(const u of e.items)if(u.type.startsWith("image/")){s.preventDefault();const T=u.getAsFile();if(T){const W=u.type.split("/")[1]||"png",q=`pasted-image-${Date.now()}.${W}`,j=new File([T],q,{type:u.type});y([j])}return}const i=(v=e.getData("text/plain"))==null?void 0:v.trim();i&&R(i)&&(s.preventDefault(),await $(i))}function R(s){var t;try{const e=new URL(s);if(!["http:","https:"].includes(e.protocol))return!1;const r=(t=e.pathname.split(".").pop())==null?void 0:t.toLowerCase();return!!(["jpg","jpeg","png","gif","webp","webm","mp4"].includes(r)||["i.imgur.com","imgur.com","i.redd.it","preview.redd.it","pbs.twimg.com","media.tumblr.com","cdn.discordapp.com","media.discordapp.net","i.pinimg.com","i.pximg.net","gelbooru.com","safebooru.org","danbooru.donmai.us"].some(u=>e.host.includes(u)))}catch{return!1}}async function $(s){m.value=!0,h("Fetching image from URL...");try{const t=await k.uploadFromUrl(s),e=w({id:++A,file:{name:t.filename,size:t.size,type:"image/*"},tags:[],safety:"safe",preview:s,uploading:!1,completed:!1,error:null,token:t.token});d.value.push(e),h("Image fetched successfully!")}catch(t){h("Failed to fetch image: "+t.message)}finally{m.value=!1}}const a=w({current:0,total:0,done:!1}),b=V(()=>d.value.filter(s=>!s.completed&&!s.error).length),E=V(()=>a.total===0?0:Math.round(a.current/a.total*100));function L(s){return s.type.startsWith("video/")?"&#9658;":"?"}function P(s){g.value=!1;const t=Array.from(s.dataTransfer.files);y(t)}function S(s){const t=Array.from(s.target.files);y(t),s.target.value=""}function y(s){for(const t of s){const e=w({id:++A,file:t,tags:[],safety:"safe",preview:null,uploading:!1,completed:!1,error:null});if(t.type.startsWith("image/")){const r=new FileReader;r.onload=i=>{e.preview=i.target.result},r.readAsDataURL(t)}d.value.push(e)}}function N(s){d.value.splice(s,1)}function M(){d.value=[],a.total=0,a.current=0,a.done=!1}function h(s){x.value=s,_.value=!0,setTimeout(()=>{_.value=!1},3e3)}async function z(){f.value=!0;const s=d.value.filter(e=>!e.completed&&!e.error);a.total=s.length,a.current=0,a.done=!1;let t=0;for(const e of s){e.uploading=!0,a.current++;try{let r=e.token;r||(r=(await k.uploadFile(e.file)).token),await k.createPost({contentToken:r,tags:e.tags,safety:e.safety}),e.completed=!0,t++,setTimeout(()=>{const i=d.value.findIndex(v=>v.id===e.id);i!==-1&&d.value[i].completed&&d.value.splice(i,1)},1500)}catch(r){e.error=r.message}finally{e.uploading=!1}}f.value=!1,a.done=!0,t>0&&h(`Successfully uploaded ${t} file${t>1?"s":""}!`),setTimeout(()=>{a.done&&(a.total=0,a.current=0,a.done=!1)},3e3)}return(s,t)=>(l(),n("div",te,[t[9]||(t[9]=o("h1",null,"Upload",-1)),o("div",{class:D(["drop-zone",{dragging:g.value,fetching:m.value}]),onDragover:t[0]||(t[0]=I(e=>g.value=!0,["prevent"])),onDragleave:t[1]||(t[1]=e=>g.value=!1),onDrop:I(P,["prevent"]),onClick:t[2]||(t[2]=e=>s.$refs.fileInput.click())},[o("input",{ref:"fileInput",type:"file",multiple:"",accept:"image/*,video/webm,video/mp4",onChange:S,style:{display:"none"}},null,544),o("div",se,[m.value?(l(),n("span",oe)):(l(),n("span",ae,"+")),m.value?(l(),n("p",ne,"Fetching image from URL...")):(l(),n("p",le,"Drop files here, click to browse, or paste images/URLs")),t[3]||(t[3]=o("p",{class:"hint"},"Supported: JPG, PNG, GIF, WebP, WebM, MP4",-1))])],34),a.total>0?(l(),n("div",{key:0,class:D(["progress-banner",{done:a.done}])},[o("div",ie,[o("div",{class:"progress-fill",style:J({width:E.value+"%"})},null,4)]),o("div",re,[a.done?(l(),n("span",de,"All uploads complete!")):(l(),n("span",ce,"Uploading "+c(a.current)+" of "+c(a.total)+"...",1))])],2)):U("",!0),d.value.length>0?(l(),n("div",ue,[o("div",pe,[o("h2",null,"Queue ("+c(b.value)+" pending)",1),o("div",fe,[o("button",{class:"btn btn-secondary",onClick:M,disabled:f.value}," Clear All ",8,me),o("button",{class:"btn",onClick:z,disabled:f.value||b.value===0},c(f.value?"Uploading...":`Upload All (${b.value})`),9,ve)])]),o("div",ge,[(l(!0),n(Q,null,X(d.value,(e,r)=>(l(),n("div",{key:e.id,class:D(["upload-item",{completed:e.completed,error:e.error,uploading:e.uploading}])},[o("div",ye,[e.preview?(l(),n("img",{key:0,src:e.preview},null,8,he)):(l(),n("span",_e,c(L(e.file)),1))]),o("div",be,[o("div",ke,c(e.file.name),1),O(ee,{modelValue:e.tags,"onUpdate:modelValue":i=>e.tags=i,placeholder:"Add tags (comma separated)...",disabled:e.completed||e.uploading},null,8,["modelValue","onUpdate:modelValue","disabled"]),o("div",we,[t[5]||(t[5]=o("label",null,"Rating:",-1)),Y(o("select",{"onUpdate:modelValue":i=>e.safety=i,disabled:e.completed||e.uploading},[...t[4]||(t[4]=[o("option",{value:"safe"},"Safe",-1),o("option",{value:"sketchy"},"Sketchy",-1),o("option",{value:"unsafe"},"Unsafe",-1)])],8,Ue),[[Z,e.safety]])])]),o("div",De,[e.uploading?(l(),n("div",Fe,[...t[6]||(t[6]=[o("span",{class:"spinner"},null,-1),F(" Uploading... ",-1)])])):e.completed?(l(),n("div",xe,[...t[7]||(t[7]=[o("span",{class:"checkmark"},"✓",-1),F(" Done! ",-1)])])):e.error?(l(),n("div",Ae,[t[8]||(t[8]=o("span",{class:"error-icon"},"✗",-1)),F(" "+c(e.error),1)])):(l(),n("button",{key:3,class:"btn btn-secondary btn-sm",onClick:i=>N(r)}," Remove ",8,Ce))])],2))),128))])])):U("",!0),_.value?(l(),n("div",Te,c(x.value),1)):U("",!0)]))}},Ee=B(Ve,[["__scopeId","data-v-ddb27314"]]);export{Ee as default};
