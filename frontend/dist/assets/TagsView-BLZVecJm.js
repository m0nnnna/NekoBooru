import{_ as E,r as s,c as K,j as Q,a as n,g as o,f as t,l as _,m as y,B as h,t as i,F as k,i as A,b as W,o as u,w as G,A as H,x as J}from"./index-DEYafuDQ.js";import{P as O}from"./Pagination-DLw_-HlR.js";const R={class:"tags-view"},X={class:"header"},Y={class:"tags-table-container"},Z={class:"tags-table"},ee=["value","onChange"],te=["value"],ae=["onClick"],le={class:"implications-section"},se={class:"add-form"},ne={class:"implications-list"},oe=["onClick"],ie={class:"aliases-section"},ue={class:"add-form"},re={class:"aliases-list"},de=["onClick"],x=50,ce={__name:"TagsView",setup(ve){const w=s([]),T=s([]),F=s(0),C=s(1),V=s(""),m=s("usage"),v=s(!1),g=s([]),r=s({antecedent:"",consequent:""}),f=s([]),d=s({alias:"",target:""}),B=K(()=>Math.ceil(F.value/x));let I=null;Q(async()=>{await Promise.all([b(),N(),U(),$()])});async function b(){try{const a=await n.getTags({q:V.value,page:C.value,limit:x,sort:m.value,order:v.value?"asc":"desc"});w.value=a.results,F.value=a.total}catch(a){console.error("Failed to fetch tags:",a)}}async function N(){try{T.value=await n.getCategories()}catch(a){console.error("Failed to fetch categories:",a)}}async function U(){try{g.value=await n.getImplications()}catch(a){console.error("Failed to fetch implications:",a)}}async function $(){try{f.value=await n.getAliases()}catch(a){console.error("Failed to fetch aliases:",a)}}function S(){clearTimeout(I),I=setTimeout(()=>{C.value=1,b()},300)}function q(a){m.value===a?v.value=!v.value:(m.value=a,v.value=!1),b()}async function D(a,e){try{await n.updateTag(a.name,{category:e}),a.category=e;const p=T.value.find(l=>l.name===e);p&&(a.categoryColor=p.color)}catch(p){alert("Failed to update tag: "+p.message)}}async function P(a){if(confirm(`Delete tag "${a.name}"? This will remove it from all posts.`))try{await n.deleteTag(a.name),w.value=w.value.filter(e=>e.id!==a.id)}catch(e){alert("Failed to delete tag: "+e.message)}}async function M(){if(!(!r.value.antecedent||!r.value.consequent))try{const a=await n.createImplication(r.value);g.value.push(a),r.value={antecedent:"",consequent:""}}catch(a){alert("Failed to add implication: "+a.message)}}async function L(a){try{await n.deleteImplication(a),g.value=g.value.filter(e=>e.id!==a)}catch(e){alert("Failed to delete implication: "+e.message)}}async function j(){if(!(!d.value.alias||!d.value.target))try{const a=await n.createAlias(d.value);f.value.push(a),d.value={alias:"",target:""}}catch(a){alert("Failed to add alias: "+a.message)}}async function z(a){try{await n.deleteAlias(a),f.value=f.value.filter(e=>e.id!==a)}catch(e){alert("Failed to delete alias: "+e.message)}}return(a,e)=>{const p=W("router-link");return u(),o("div",R,[t("div",X,[e[8]||(e[8]=t("h1",null,"Tags",-1)),y(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=l=>V.value=l),placeholder:"Search tags...",onInput:S},null,544),[[h,V.value]])]),t("div",Y,[t("table",Z,[t("thead",null,[t("tr",null,[t("th",{onClick:e[1]||(e[1]=l=>q("name")),class:"sortable"}," Name "+i(m.value==="name"?v.value?"▲":"▼":""),1),e[9]||(e[9]=t("th",null,"Category",-1)),t("th",{onClick:e[2]||(e[2]=l=>q("usage")),class:"sortable"}," Posts "+i(m.value==="usage"?v.value?"▲":"▼":""),1),e[10]||(e[10]=t("th",null,"Actions",-1))])]),t("tbody",null,[(u(!0),o(k,null,A(w.value,l=>(u(),o("tr",{key:l.id},[t("td",null,[_(p,{to:{path:"/",query:{q:l.name}},class:"tag-link"},{default:G(()=>[H(i(l.name),1)]),_:2},1032,["to"])]),t("td",null,[t("select",{value:l.category,onChange:c=>D(l,c.target.value),style:J({borderLeftColor:l.categoryColor}),class:"category-select"},[(u(!0),o(k,null,A(T.value,c=>(u(),o("option",{key:c.id,value:c.name},i(c.name),9,te))),128))],44,ee)]),t("td",null,i(l.usageCount),1),t("td",null,[t("button",{class:"btn btn-secondary btn-sm",onClick:c=>P(l)}," Delete ",8,ae)])]))),128))])])]),_(O,{modelValue:C.value,"onUpdate:modelValue":[e[3]||(e[3]=l=>C.value=l),b],pages:B.value},null,8,["modelValue","pages"]),t("div",le,[e[13]||(e[13]=t("h2",null,"Tag Implications",-1)),e[14]||(e[14]=t("p",{class:"hint"},"When tag A implies tag B, adding A will automatically add B",-1)),t("div",se,[y(t("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>r.value.antecedent=l),placeholder:"Source tag"},null,512),[[h,r.value.antecedent]]),e[11]||(e[11]=t("span",null,"implies",-1)),y(t("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>r.value.consequent=l),placeholder:"Target tag"},null,512),[[h,r.value.consequent]]),t("button",{class:"btn",onClick:M},"Add")]),t("div",ne,[(u(!0),o(k,null,A(g.value,l=>(u(),o("div",{key:l.id,class:"implication-item"},[t("span",null,i(l.antecedent),1),e[12]||(e[12]=t("span",{class:"arrow"},"→",-1)),t("span",null,i(l.consequent),1),t("button",{class:"delete-btn",onClick:c=>L(l.id)},"×",8,oe)]))),128))])]),t("div",ie,[e[17]||(e[17]=t("h2",null,"Tag Aliases",-1)),e[18]||(e[18]=t("p",{class:"hint"},"Aliases redirect to canonical tags",-1)),t("div",ue,[y(t("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>d.value.alias=l),placeholder:"Alias"},null,512),[[h,d.value.alias]]),e[15]||(e[15]=t("span",null,"points to",-1)),y(t("input",{"onUpdate:modelValue":e[7]||(e[7]=l=>d.value.target=l),placeholder:"Canonical tag"},null,512),[[h,d.value.target]]),t("button",{class:"btn",onClick:j},"Add")]),t("div",re,[(u(!0),o(k,null,A(f.value,l=>(u(),o("div",{key:l.id,class:"alias-item"},[t("span",null,i(l.aliasName),1),e[16]||(e[16]=t("span",{class:"arrow"},"→",-1)),t("span",null,i(l.targetName),1),t("button",{class:"delete-btn",onClick:c=>z(l.id)},"×",8,de)]))),128))])])])}}},ge=E(ce,[["__scopeId","data-v-4e2ae83a"]]);export{ge as default};
