import{_ as H,r as p,j as X,s as J,a as _,C as k,c as I,g as i,f as o,h as F,y as P,n as T,x as Q,t as c,F as K,i as O,q as Z,o as r,l as ee,m as te,p as se,A as x}from"./index-CqHeEMp4.js";import{T as oe}from"./TagInput-CvOvS1F9.js";const ae={class:"upload-view"},le={class:"drop-content"},ne={key:0,class:"drop-icon spinner-icon"},ie={key:1,class:"drop-icon"},re={key:2},de={key:3},ce={key:4},ue={class:"progress-bar"},pe={class:"progress-text"},fe={key:0},me={key:1},ve={key:1,class:"upload-queue"},ge={class:"queue-header"},he={class:"queue-actions"},ye=["disabled"],we=["disabled"],_e={class:"upload-list"},ke={class:"preview"},be=["src"],Ue={key:1,class:"no-preview"},De={class:"upload-details"},Fe={class:"filename"},Te={class:"safety-row"},xe=["onUpdate:modelValue","disabled"],Ve={class:"upload-status"},Ae={key:0,class:"status uploading"},Ce={key:1,class:"status completed"},Ie={key:2,class:"status error"},Pe=["onClick"],Re={key:2,class:"toast success"},$e={__name:"UploadView",setup(Le){Z();const y=p(!1),d=p([]),m=p(!1),b=p(!1),V=p(""),v=p(!1),g=p(!1);let U=0;X(()=>{document.addEventListener("paste",A)}),J(()=>{document.removeEventListener("paste",A)});async function A(s){var h;const t=document.activeElement;if(t&&(t.tagName==="INPUT"||t.tagName==="TEXTAREA"))return;const e=s.clipboardData;if(!e)return;const l=Array.from(e.files);if(l.length>0){s.preventDefault(),w(l);return}for(const f of e.items)if(f.type.startsWith("image/")){s.preventDefault();const C=f.getAsFile();if(C){const B=f.type.split("/")[1]||"png",G=`pasted-image-${Date.now()}.${B}`,Y=new File([C],G,{type:f.type});w([Y])}return}const n=(h=e.getData("text/plain"))==null?void 0:h.trim();n&&(R(n)?(s.preventDefault(),await E(n)):$(n)&&(s.preventDefault(),await L(n)))}function R(s){try{const t=new URL(s);return["http:","https:"].includes(t.protocol)&&["twitter.com","x.com","youtube.com","youtu.be","www.youtube.com","tiktok.com","www.tiktok.com","instagram.com","www.instagram.com","reddit.com","www.reddit.com","old.reddit.com","vimeo.com","twitch.tv","clips.twitch.tv","dailymotion.com","streamable.com","v.redd.it"].some(l=>t.host===l||t.host.endsWith("."+l))?t.host.includes("instagram.com")?t.pathname.includes("/reel/")||t.pathname.includes("/p/"):(t.host.includes("reddit.com")||t.host==="v.redd.it",!0):!1}catch{return!1}}function $(s){var t;try{const e=new URL(s);if(!["http:","https:"].includes(e.protocol))return!1;const l=(t=e.pathname.split(".").pop())==null?void 0:t.toLowerCase();return!!(["jpg","jpeg","png","gif","webp","webm","mp4"].includes(l)||["i.imgur.com","imgur.com","i.redd.it","preview.redd.it","pbs.twimg.com","media.tumblr.com","cdn.discordapp.com","media.discordapp.net","i.pinimg.com","i.pximg.net","gelbooru.com","safebooru.org","danbooru.donmai.us"].some(f=>e.host.includes(f)))}catch{return!1}}async function L(s){v.value=!0,u("Fetching image from URL...");try{const t=await _.uploadFromUrl(s),e=k({id:++U,file:{name:t.filename,size:t.size,type:"image/*"},tags:[],safety:"safe",preview:s,uploading:!1,completed:!1,error:null,token:t.token});d.value.push(e),u("Image fetched successfully!")}catch(t){u("Failed to fetch image: "+t.message)}finally{v.value=!1}}async function E(s){var t;g.value=!0,u("Downloading video...");try{const e=await _.uploadFromYtdlp(s),l=k({id:++U,file:{name:e.filename,size:0,type:"video/mp4"},tags:[],safety:"safe",preview:e.thumbnail||null,uploading:!1,completed:!1,error:null,token:e.token,videoInfo:{title:e.title,duration:e.duration,uploader:e.uploader}});d.value.push(l);const n=((t=e.title)==null?void 0:t.length)>50?e.title.slice(0,50)+"...":e.title;u(`Video downloaded: ${n}`)}catch(e){u("Failed to download video: "+e.message)}finally{g.value=!1}}const a=k({current:0,total:0,done:!1}),D=I(()=>d.value.filter(s=>!s.completed&&!s.error).length),S=I(()=>a.total===0?0:Math.round(a.current/a.total*100));function N(s){return s.type.startsWith("video/")?"&#9658;":"?"}function M(s){y.value=!1;const t=Array.from(s.dataTransfer.files);w(t)}function z(s){const t=Array.from(s.target.files);w(t),s.target.value=""}function w(s){for(const t of s){const e=k({id:++U,file:t,tags:[],safety:"safe",preview:null,uploading:!1,completed:!1,error:null});if(t.type.startsWith("image/")){const l=new FileReader;l.onload=n=>{e.preview=n.target.result},l.readAsDataURL(t)}d.value.push(e)}}function W(s){d.value.splice(s,1)}function q(){d.value=[],a.total=0,a.current=0,a.done=!1}function u(s){V.value=s,b.value=!0,setTimeout(()=>{b.value=!1},3e3)}async function j(){m.value=!0;const s=d.value.filter(e=>!e.completed&&!e.error);a.total=s.length,a.current=0,a.done=!1;let t=0;for(const e of s){e.uploading=!0,a.current++;try{let l=e.token;l||(l=(await _.uploadFile(e.file)).token),await _.createPost({contentToken:l,tags:e.tags,safety:e.safety}),e.completed=!0,t++,setTimeout(()=>{const n=d.value.findIndex(h=>h.id===e.id);n!==-1&&d.value[n].completed&&d.value.splice(n,1)},1500)}catch(l){e.error=l.message}finally{e.uploading=!1}}m.value=!1,a.done=!0,t>0&&u(`Successfully uploaded ${t} file${t>1?"s":""}!`),setTimeout(()=>{a.done&&(a.total=0,a.current=0,a.done=!1)},3e3)}return(s,t)=>(r(),i("div",ae,[t[9]||(t[9]=o("h1",null,"Upload",-1)),o("div",{class:T(["drop-zone",{dragging:y.value,fetching:v.value||g.value}]),onDragover:t[0]||(t[0]=P(e=>y.value=!0,["prevent"])),onDragleave:t[1]||(t[1]=e=>y.value=!1),onDrop:P(M,["prevent"]),onClick:t[2]||(t[2]=e=>s.$refs.fileInput.click())},[o("input",{ref:"fileInput",type:"file",multiple:"",accept:"image/*,video/webm,video/mp4",onChange:z,style:{display:"none"}},null,544),o("div",le,[v.value||g.value?(r(),i("span",ne)):(r(),i("span",ie,"+")),g.value?(r(),i("p",re,"Downloading video... (this may take a moment)")):v.value?(r(),i("p",de,"Fetching image from URL...")):(r(),i("p",ce,"Drop files here, click to browse, or paste images/URLs")),t[3]||(t[3]=o("p",{class:"hint"},"Supported: JPG, PNG, GIF, WebP, WebM, MP4 + video links (X, YouTube, TikTok, etc.)",-1))])],34),a.total>0?(r(),i("div",{key:0,class:T(["progress-banner",{done:a.done}])},[o("div",ue,[o("div",{class:"progress-fill",style:Q({width:S.value+"%"})},null,4)]),o("div",pe,[a.done?(r(),i("span",fe,"All uploads complete!")):(r(),i("span",me,"Uploading "+c(a.current)+" of "+c(a.total)+"...",1))])],2)):F("",!0),d.value.length>0?(r(),i("div",ve,[o("div",ge,[o("h2",null,"Queue ("+c(D.value)+" pending)",1),o("div",he,[o("button",{class:"btn btn-secondary",onClick:q,disabled:m.value}," Clear All ",8,ye),o("button",{class:"btn",onClick:j,disabled:m.value||D.value===0},c(m.value?"Uploading...":`Upload All (${D.value})`),9,we)])]),o("div",_e,[(r(!0),i(K,null,O(d.value,(e,l)=>(r(),i("div",{key:e.id,class:T(["upload-item",{completed:e.completed,error:e.error,uploading:e.uploading}])},[o("div",ke,[e.preview?(r(),i("img",{key:0,src:e.preview},null,8,be)):(r(),i("span",Ue,c(N(e.file)),1))]),o("div",De,[o("div",Fe,c(e.file.name),1),ee(oe,{modelValue:e.tags,"onUpdate:modelValue":n=>e.tags=n,placeholder:"Add tags (comma separated)...",disabled:e.completed||e.uploading},null,8,["modelValue","onUpdate:modelValue","disabled"]),o("div",Te,[t[5]||(t[5]=o("label",null,"Rating:",-1)),te(o("select",{"onUpdate:modelValue":n=>e.safety=n,disabled:e.completed||e.uploading},[...t[4]||(t[4]=[o("option",{value:"safe"},"Safe",-1),o("option",{value:"sketchy"},"Sketchy",-1),o("option",{value:"unsafe"},"Unsafe",-1)])],8,xe),[[se,e.safety]])])]),o("div",Ve,[e.uploading?(r(),i("div",Ae,[...t[6]||(t[6]=[o("span",{class:"spinner"},null,-1),x(" Uploading... ",-1)])])):e.completed?(r(),i("div",Ce,[...t[7]||(t[7]=[o("span",{class:"checkmark"},"✓",-1),x(" Done! ",-1)])])):e.error?(r(),i("div",Ie,[t[8]||(t[8]=o("span",{class:"error-icon"},"✗",-1)),x(" "+c(e.error),1)])):(r(),i("button",{key:3,class:"btn btn-secondary btn-sm",onClick:n=>W(l)}," Remove ",8,Pe))])],2))),128))])])):F("",!0),b.value?(r(),i("div",Re,c(V.value),1)):F("",!0)]))}},Ne=H($e,[["__scopeId","data-v-abb2bf20"]]);export{Ne as default};
