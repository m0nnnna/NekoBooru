import{d as D,r as u,c as U,a as q,_ as N,b as G,e as O,o as p,w as M,f as l,g as m,h as C,F as E,i as R,n as x,j as H,u as J,k as L,l as j,t as A,m as $,v as I,p as B,q as K}from"./index-CqHeEMp4.js";import{P as Q}from"./Pagination-CW46Mz10.js";const T=D("posts",()=>{const a=u([]),n=u(null),g=u(0),i=u(1),v=u(40),f=u(""),c=u(!1),d=u(null),V=U(()=>Math.ceil(g.value/v.value));async function r(o={}){c.value=!0,d.value=null;try{const t=await q.getPosts({q:f.value,page:i.value,limit:v.value,...o});a.value=t.results,g.value=t.total}catch(t){d.value=t.message}finally{c.value=!1}}async function P(o){c.value=!0,d.value=null;try{n.value=await q.getPost(o)}catch(t){d.value=t.message}finally{c.value=!1}}async function F(o,t){var e;try{const s=await q.updatePost(o,t);((e=n.value)==null?void 0:e.id)===o&&(n.value=s);const b=a.value.findIndex(h=>h.id===o);return b!==-1&&(a.value[b]=s),s}catch(s){throw d.value=s.message,s}}async function S(o){var t;try{await q.deletePost(o),a.value=a.value.filter(e=>e.id!==o),((t=n.value)==null?void 0:t.id)===o&&(n.value=null)}catch(e){throw d.value=e.message,e}}async function k(o){var t;try{const e=await q.toggleFavorite(o);((t=n.value)==null?void 0:t.id)===o&&(n.value.isFavorited=e.isFavorited);const s=a.value.find(b=>b.id===o);return s&&(s.isFavorited=e.isFavorited),e.isFavorited}catch(e){throw d.value=e.message,e}}function y(o){f.value=o,i.value=1}function _(o){i.value=o}return{posts:a,currentPost:n,total:g,page:i,limit:v,pages:V,query:f,loading:c,error:d,fetchPosts:r,fetchPost:P,updatePost:F,deletePost:S,toggleFavorite:k,setQuery:y,setPage:_}}),W={class:"thumb-container"},X=["src","alt"],Y={key:0,class:"badge video-badge"},Z={key:1,class:"badge gif-badge"},ee={key:2,class:"badge fav-badge"},te={__name:"PostCard",props:{post:{type:Object,required:!0}},setup(a){const n=a,g=U(()=>[".webm",".mp4"].includes(n.post.extension)),i=U(()=>n.post.extension===".gif");function v(f){f.target.style.opacity="0.5"}return(f,c)=>{const d=G("router-link");return p(),O(d,{to:`/post/${a.post.id}`,class:"post-card"},{default:M(()=>[l("div",W,[l("img",{src:a.post.thumbUrl,alt:a.post.filename,loading:"lazy",onError:v},null,40,X),g.value?(p(),m("div",Y,"►")):C("",!0),i.value?(p(),m("div",Z,"GIF")):C("",!0),a.post.isFavorited?(p(),m("div",ee,"♥")):C("",!0)])]),_:1},8,["to"])}}},se=N(te,[["__scopeId","data-v-58e887ed"]]),ae={key:0,class:"empty-state"},oe={key:1,class:"loading-state"},le={__name:"PostGrid",props:{posts:{type:Array,required:!0},loading:{type:Boolean,default:!1}},emits:["select"],setup(a){return(n,g)=>(p(),m("div",{class:x(["post-grid",{"is-loading":a.loading&&a.posts.length>0}])},[(p(!0),m(E,null,R(a.posts,i=>(p(),O(se,{key:i.id,post:i,onClick:v=>n.$emit("select",i)},null,8,["post","onClick"]))),128)),a.posts.length===0&&!a.loading?(p(),m("div",ae," No posts found ")):C("",!0),a.loading&&a.posts.length===0?(p(),m("div",oe," Loading... ")):C("",!0)],2))}},ne=N(le,[["__scopeId","data-v-a5fed724"]]),ue={class:"home-view"},ie={class:"toolbar"},ce={class:"result-count"},re={class:"toolbar-controls"},de={class:"safety-filter"},ve={class:"sort-controls"},fe={__name:"HomeView",setup(a){const n=J(),g=K(),i=T(),v=u("date"),f=u("desc"),c=u(1),d={safe:!0,sketchy:!0,unsafe:!0};function V(){try{const t=localStorage.getItem("safetyFilter");if(t){const e=JSON.parse(t);if(typeof e=="object"&&"safe"in e)return e}}catch{}return{...d}}const r=u(V()),P=u([]),F=u(0),S=u(0),k=u(!1);H(()=>{n.query.q&&i.setQuery(n.query.q),n.query.page&&(c.value=parseInt(n.query.page)||1),y()}),L(()=>n.query,t=>{t.q!==i.query&&i.setQuery(t.q||""),t.page?c.value=parseInt(t.page)||1:c.value=1,y()});async function y(){k.value=!0;try{let t=i.query;const{safe:e,sketchy:s,unsafe:b}=r.value,h=[];e||h.push("-safety:safe"),s||h.push("-safety:sketchy"),b||h.push("-safety:unsafe"),h.length>0&&(t=t?`${t} ${h.join(" ")}`:h.join(" "));const w=await fetch(`/api/posts?q=${encodeURIComponent(t)}&page=${c.value}&sort=${v.value}&order=${f.value}`).then(z=>z.json());P.value=w.results,F.value=w.total,S.value=w.pages}catch(t){console.error("Failed to fetch posts:",t)}finally{k.value=!1}}function _(){localStorage.setItem("safetyFilter",JSON.stringify(r.value)),c.value=1,y()}function o(t){c.value=t,g.push({query:{...n.query,page:t>1?t:void 0}}),y()}return(t,e)=>(p(),m("div",ue,[l("div",ie,[l("div",ce,[l("span",{class:x({"loading-fade":k.value})},A(F.value)+" posts found",3)]),l("div",re,[l("div",de,[l("label",{class:x(["safety-checkbox safe",{active:r.value.safe}]),title:"Safe"},[$(l("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=s=>r.value.safe=s),onChange:_},null,544),[[I,r.value.safe]])],2),l("label",{class:x(["safety-checkbox sketchy",{active:r.value.sketchy}]),title:"Sketchy"},[$(l("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=s=>r.value.sketchy=s),onChange:_},null,544),[[I,r.value.sketchy]])],2),l("label",{class:x(["safety-checkbox unsafe",{active:r.value.unsafe}]),title:"Unsafe"},[$(l("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=s=>r.value.unsafe=s),onChange:_},null,544),[[I,r.value.unsafe]])],2)]),l("div",ve,[$(l("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>v.value=s),onChange:y},[...e[6]||(e[6]=[l("option",{value:"date"},"Date",-1),l("option",{value:"id"},"ID",-1),l("option",{value:"size"},"Size",-1)])],544),[[B,v.value]]),$(l("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>f.value=s),onChange:y},[...e[7]||(e[7]=[l("option",{value:"desc"},"Newest first",-1),l("option",{value:"asc"},"Oldest first",-1)])],544),[[B,f.value]])])])]),j(ne,{posts:P.value,loading:k.value},null,8,["posts","loading"]),j(Q,{modelValue:c.value,"onUpdate:modelValue":[e[5]||(e[5]=s=>c.value=s),o],pages:S.value},null,8,["modelValue","pages"])]))}},ye=N(fe,[["__scopeId","data-v-9a884bb8"]]);export{ye as default};
