import{_ as z,r as d,j as E,a as w,g as i,f as s,h as v,m as S,B as x,A as b,t as e,n as P,o as n}from"./index-Zgtdju1z.js";const I={class:"settings-view"},q={class:"settings-section"},U={class:"form-group"},Y={class:"path-input-group"},G={class:"help-text"},O={key:0,class:"migration-prompt"},R={class:"alert alert-warning"},W={class:"migration-info"},j={key:0,class:"migration-details"},X={key:0},H={key:1},J={class:"form-actions"},K=["disabled"],Q={class:"settings-section"},Z={class:"form-group"},$={class:"path-input-group"},ss={class:"help-text"},ts={class:"form-actions"},es=["disabled"],as=["disabled"],ls={class:"settings-section"},os={class:"info-grid"},is={class:"info-item"},ns={class:"info-item"},ds={class:"info-item"},us={class:"info-item"},rs={class:"settings-section"},cs={key:0,class:"stats-loading"},vs={key:1,class:"stats-error"},ps={key:2,class:"stats-grid"},gs={class:"stat-card"},fs={class:"stat-value"},_s={class:"stat-card"},ms={class:"stat-value"},ws={class:"stat-card"},hs={class:"stat-value"},ys={class:"stat-card"},bs={class:"stat-value"},ks={class:"stat-card wide"},Cs={class:"stat-value"},Ds={class:"stat-card wide"},Ss={class:"stat-value"},xs={key:0,class:"stat-card wide"},Ps={class:"stat-value"},Ns={key:1,class:"stat-card wide"},Ms={class:"stat-value"},Fs={__name:"SettingsView",setup(Vs){const u=d({}),c=d(""),f=d(!1),N=d(navigator.platform.toLowerCase().includes("win")),_=d(""),m=d(!1),g=d({show:!1,success:!1,message:""}),r=d({}),k=d(!0),h=d(null),p=d({show:!1,old_path:"",new_path:""}),l=d({show:!1,success:!1,message:"",details:null});E(async()=>{await Promise.all([y(),M()])});async function M(){k.value=!0,h.value=null;try{r.value=await w.getStats()}catch(a){h.value="Failed to load statistics: "+a.message}finally{k.value=!1}}function C(a){return a?new Date(a).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A"}async function y(){try{u.value=await w.getSettings(),c.value=u.value.data_dir||"",_.value=u.value.ytdlp_cookies_path||""}catch(a){alert("Failed to load settings: "+a.message)}}async function F(){if(!c.value.trim()){alert("Please enter a data directory path");return}f.value=!0,p.show=!1,l.show=!1;try{const a=await w.updateDataDir(c.value.trim(),!1);a.needs_migration?p.value={show:!0,old_path:a.old_path,new_path:a.new_path}:(await y(),alert("Settings saved successfully!"))}catch(a){alert("Failed to save settings: "+a.message)}finally{f.value=!1}}async function V(){var a,t;f.value=!0,p.show=!1;try{const o=await w.updateDataDir(c.value.trim(),!0);l.value={show:!0,success:o.success||!1,message:o.message||(o.success?"Migration completed successfully":"Migration failed"),details:o.migration||null,files_copied:(a=o.migration)==null?void 0:a.files_copied,directories_copied:(t=o.migration)==null?void 0:t.directories_copied},o.success&&(await y(),setTimeout(()=>{window.location.reload()},2e3))}catch(o){l.value={show:!0,success:!1,message:"Migration failed: "+o.message,details:null}}finally{f.value=!1}}function L(){p.show=!1,c.value=u.value.data_dir||""}function T(){c.value=u.value.data_dir||"",p.show=!1,l.show=!1}function A(){alert("Directory browsing requires a native file picker. Please enter the path manually.")}async function D(){m.value=!0,g.value.show=!1;try{const a=await w.updateYtdlpCookies(_.value.trim()||null);g.value={show:!0,success:!0,message:a.message},await y()}catch(a){g.value={show:!0,success:!1,message:a.message}}finally{m.value=!1}}async function B(){_.value="",await D()}return(a,t)=>(n(),i("div",I,[t[30]||(t[30]=s("h1",null,"Settings",-1)),s("div",q,[t[10]||(t[10]=s("h2",null,"Data Storage",-1)),t[11]||(t[11]=s("p",{class:"section-description"}," Configure where NekoBooru stores your data (posts, thumbnails, database). Changing this location will migrate your existing data. ",-1)),s("div",U,[t[3]||(t[3]=s("label",null,"Data Directory",-1)),s("div",Y,[S(s("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>c.value=o),type:"text",placeholder:"Enter data directory path",class:"path-input"},null,512),[[x,c.value]]),N.value?v("",!0):(n(),i("button",{key:0,class:"btn btn-secondary",onClick:A}," Browse "))]),s("p",G,[t[2]||(t[2]=b(" Current: ",-1)),s("code",null,e(u.value.data_dir||"Loading..."),1)])]),p.value.show?(n(),i("div",O,[s("div",R,[t[8]||(t[8]=s("strong",null,"⚠️ Data Migration Required",-1)),t[9]||(t[9]=s("p",null," Data exists at the old location. Would you like to migrate it to the new location? ",-1)),s("div",W,[s("p",null,[t[4]||(t[4]=s("strong",null,"From:",-1)),t[5]||(t[5]=b()),s("code",null,e(p.value.old_path),1)]),s("p",null,[t[6]||(t[6]=s("strong",null,"To:",-1)),t[7]||(t[7]=b()),s("code",null,e(p.value.new_path),1)])]),s("div",{class:"migration-actions"},[s("button",{class:"btn",onClick:V},"Yes, Migrate Data"),s("button",{class:"btn btn-secondary",onClick:L},"Cancel")])])])):v("",!0),l.value.show?(n(),i("div",{key:1,class:P(["migration-status",l.value.success?"success":"error"])},[s("p",null,[s("strong",null,e(l.value.success?"✓":"✗")+" "+e(l.value.message),1)]),l.value.details?(n(),i("div",j,[l.value.files_copied!==void 0?(n(),i("p",X," Files copied: "+e(l.value.files_copied),1)):v("",!0),l.value.directories_copied!==void 0?(n(),i("p",H," Directories copied: "+e(l.value.directories_copied),1)):v("",!0)])):v("",!0)],2)):v("",!0),s("div",J,[s("button",{class:"btn",onClick:F,disabled:!c.value.trim()||f.value},e(f.value?"Saving...":"Save Settings"),9,K),s("button",{class:"btn btn-secondary",onClick:T},"Reset")])]),s("div",Q,[t[14]||(t[14]=s("h2",null,"Video Downloads (yt-dlp)",-1)),t[15]||(t[15]=s("p",{class:"section-description"},' Configure cookies for downloading age-restricted or login-required videos from platforms like X/Twitter. Export cookies from your browser using an extension like "Get cookies.txt LOCALLY" and place the file on the server. ',-1)),s("div",Z,[t[13]||(t[13]=s("label",null,"Cookies File Path",-1)),s("div",$,[S(s("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>_.value=o),type:"text",placeholder:"e.g., /path/to/cookies.txt",class:"path-input"},null,512),[[x,_.value]])]),s("p",ss,[t[12]||(t[12]=b(" Current: ",-1)),s("code",null,e(u.value.ytdlp_cookies_path||"Not configured"),1)])]),g.value.show?(n(),i("div",{key:0,class:P(["cookies-status",g.value.success?"success":"error"])},[s("p",null,[s("strong",null,e(g.value.success?"✓":"✗")+" "+e(g.value.message),1)])],2)):v("",!0),s("div",ts,[s("button",{class:"btn",onClick:D,disabled:m.value},e(m.value?"Saving...":"Save Cookies Path"),9,es),s("button",{class:"btn btn-secondary",onClick:B,disabled:m.value}," Clear ",8,as)])]),s("div",ls,[t[20]||(t[20]=s("h2",null,"Directory Information",-1)),s("div",os,[s("div",is,[t[16]||(t[16]=s("label",null,"Database",-1)),s("code",null,e(u.value.database_path||"N/A"),1)]),s("div",ns,[t[17]||(t[17]=s("label",null,"Posts",-1)),s("code",null,e(u.value.posts_dir||"N/A"),1)]),s("div",ds,[t[18]||(t[18]=s("label",null,"Thumbnails",-1)),s("code",null,e(u.value.thumbs_dir||"N/A"),1)]),s("div",us,[t[19]||(t[19]=s("label",null,"Uploads",-1)),s("code",null,e(u.value.uploads_dir||"N/A"),1)])])]),s("div",rs,[t[29]||(t[29]=s("h2",null,"Server Statistics",-1)),k.value?(n(),i("div",cs,"Loading statistics...")):h.value?(n(),i("div",vs,e(h.value),1)):(n(),i("div",ps,[s("div",gs,[s("div",fs,e(r.value.total_files),1),t[21]||(t[21]=s("div",{class:"stat-label"},"Total Files",-1))]),s("div",_s,[s("div",ms,e(r.value.images),1),t[22]||(t[22]=s("div",{class:"stat-label"},"Images",-1))]),s("div",ws,[s("div",hs,e(r.value.gifs),1),t[23]||(t[23]=s("div",{class:"stat-label"},"GIFs",-1))]),s("div",ys,[s("div",bs,e(r.value.videos),1),t[24]||(t[24]=s("div",{class:"stat-label"},"Videos",-1))]),s("div",ks,[s("div",Cs,e(r.value.total_size_formatted),1),t[25]||(t[25]=s("div",{class:"stat-label"},"Total Media Size",-1))]),s("div",Ds,[s("div",Ss,e(r.value.database_size_formatted),1),t[26]||(t[26]=s("div",{class:"stat-label"},"Database Size",-1))]),r.value.oldest_post?(n(),i("div",xs,[s("div",Ps,e(C(r.value.oldest_post)),1),t[27]||(t[27]=s("div",{class:"stat-label"},"Oldest Post",-1))])):v("",!0),r.value.newest_post?(n(),i("div",Ns,[s("div",Ms,e(C(r.value.newest_post)),1),t[28]||(t[28]=s("div",{class:"stat-label"},"Newest Post",-1))])):v("",!0)]))])]))}},Ts=z(Fs,[["__scopeId","data-v-895f8a67"]]);export{Ts as default};
