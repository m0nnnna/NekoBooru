import{_ as x,r as c,j as F,a as f,g as l,f as s,h as g,m as P,B as T,A as y,t as e,n as V,o}from"./index-DEYafuDQ.js";const A={class:"settings-view"},B={class:"settings-section"},z={class:"form-group"},L={class:"path-input-group"},I={class:"help-text"},E={key:0,class:"migration-prompt"},q={class:"alert alert-warning"},R={class:"migration-info"},U={key:0,class:"migration-details"},W={key:0},j={key:1},G={class:"form-actions"},O=["disabled"],Y={class:"settings-section"},H={class:"info-grid"},J={class:"info-item"},K={class:"info-item"},Q={class:"info-item"},X={class:"info-item"},Z={class:"settings-section"},$={key:0,class:"stats-loading"},ss={key:1,class:"stats-error"},ts={key:2,class:"stats-grid"},es={class:"stat-card"},as={class:"stat-value"},is={class:"stat-card"},ls={class:"stat-value"},os={class:"stat-card"},ns={class:"stat-value"},ds={class:"stat-card"},rs={class:"stat-value"},us={class:"stat-card wide"},cs={class:"stat-value"},vs={class:"stat-card wide"},gs={class:"stat-value"},_s={key:0,class:"stat-card wide"},ps={class:"stat-value"},fs={key:1,class:"stat-card wide"},ms={class:"stat-value"},ws={__name:"SettingsView",setup(ys){const r=c({}),u=c(""),_=c(!1),h=c(navigator.platform.toLowerCase().includes("win")),n=c({}),m=c(!0),p=c(null),v=c({show:!1,old_path:"",new_path:""}),i=c({show:!1,success:!1,message:"",details:null});F(async()=>{await Promise.all([w(),D()])});async function D(){m.value=!0,p.value=null;try{n.value=await f.getStats()}catch(a){p.value="Failed to load statistics: "+a.message}finally{m.value=!1}}function b(a){return a?new Date(a).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A"}async function w(){try{r.value=await f.getSettings(),u.value=r.value.data_dir||""}catch(a){alert("Failed to load settings: "+a.message)}}async function k(){if(!u.value.trim()){alert("Please enter a data directory path");return}_.value=!0,v.show=!1,i.show=!1;try{const a=await f.updateDataDir(u.value.trim(),!1);a.needs_migration?v.value={show:!0,old_path:a.old_path,new_path:a.new_path}:(await w(),alert("Settings saved successfully!"))}catch(a){alert("Failed to save settings: "+a.message)}finally{_.value=!1}}async function S(){var a,t;_.value=!0,v.show=!1;try{const d=await f.updateDataDir(u.value.trim(),!0);i.value={show:!0,success:d.success||!1,message:d.message||(d.success?"Migration completed successfully":"Migration failed"),details:d.migration||null,files_copied:(a=d.migration)==null?void 0:a.files_copied,directories_copied:(t=d.migration)==null?void 0:t.directories_copied},d.success&&(await w(),setTimeout(()=>{window.location.reload()},2e3))}catch(d){i.value={show:!0,success:!1,message:"Migration failed: "+d.message,details:null}}finally{_.value=!1}}function C(){v.show=!1,u.value=r.value.data_dir||""}function M(){u.value=r.value.data_dir||"",v.show=!1,i.show=!1}function N(){alert("Directory browsing requires a native file picker. Please enter the path manually.")}return(a,t)=>(o(),l("div",A,[t[25]||(t[25]=s("h1",null,"Settings",-1)),s("div",B,[t[9]||(t[9]=s("h2",null,"Data Storage",-1)),t[10]||(t[10]=s("p",{class:"section-description"}," Configure where NekoBooru stores your data (posts, thumbnails, database). Changing this location will migrate your existing data. ",-1)),s("div",z,[t[2]||(t[2]=s("label",null,"Data Directory",-1)),s("div",L,[P(s("input",{"onUpdate:modelValue":t[0]||(t[0]=d=>u.value=d),type:"text",placeholder:"Enter data directory path",class:"path-input"},null,512),[[T,u.value]]),h.value?g("",!0):(o(),l("button",{key:0,class:"btn btn-secondary",onClick:N}," Browse "))]),s("p",I,[t[1]||(t[1]=y(" Current: ",-1)),s("code",null,e(r.value.data_dir||"Loading..."),1)])]),v.value.show?(o(),l("div",E,[s("div",q,[t[7]||(t[7]=s("strong",null,"⚠️ Data Migration Required",-1)),t[8]||(t[8]=s("p",null," Data exists at the old location. Would you like to migrate it to the new location? ",-1)),s("div",R,[s("p",null,[t[3]||(t[3]=s("strong",null,"From:",-1)),t[4]||(t[4]=y()),s("code",null,e(v.value.old_path),1)]),s("p",null,[t[5]||(t[5]=s("strong",null,"To:",-1)),t[6]||(t[6]=y()),s("code",null,e(v.value.new_path),1)])]),s("div",{class:"migration-actions"},[s("button",{class:"btn",onClick:S},"Yes, Migrate Data"),s("button",{class:"btn btn-secondary",onClick:C},"Cancel")])])])):g("",!0),i.value.show?(o(),l("div",{key:1,class:V(["migration-status",i.value.success?"success":"error"])},[s("p",null,[s("strong",null,e(i.value.success?"✓":"✗")+" "+e(i.value.message),1)]),i.value.details?(o(),l("div",U,[i.value.files_copied!==void 0?(o(),l("p",W," Files copied: "+e(i.value.files_copied),1)):g("",!0),i.value.directories_copied!==void 0?(o(),l("p",j," Directories copied: "+e(i.value.directories_copied),1)):g("",!0)])):g("",!0)],2)):g("",!0),s("div",G,[s("button",{class:"btn",onClick:k,disabled:!u.value.trim()||_.value},e(_.value?"Saving...":"Save Settings"),9,O),s("button",{class:"btn btn-secondary",onClick:M},"Reset")])]),s("div",Y,[t[15]||(t[15]=s("h2",null,"Directory Information",-1)),s("div",H,[s("div",J,[t[11]||(t[11]=s("label",null,"Database",-1)),s("code",null,e(r.value.database_path||"N/A"),1)]),s("div",K,[t[12]||(t[12]=s("label",null,"Posts",-1)),s("code",null,e(r.value.posts_dir||"N/A"),1)]),s("div",Q,[t[13]||(t[13]=s("label",null,"Thumbnails",-1)),s("code",null,e(r.value.thumbs_dir||"N/A"),1)]),s("div",X,[t[14]||(t[14]=s("label",null,"Uploads",-1)),s("code",null,e(r.value.uploads_dir||"N/A"),1)])])]),s("div",Z,[t[24]||(t[24]=s("h2",null,"Server Statistics",-1)),m.value?(o(),l("div",$,"Loading statistics...")):p.value?(o(),l("div",ss,e(p.value),1)):(o(),l("div",ts,[s("div",es,[s("div",as,e(n.value.total_files),1),t[16]||(t[16]=s("div",{class:"stat-label"},"Total Files",-1))]),s("div",is,[s("div",ls,e(n.value.images),1),t[17]||(t[17]=s("div",{class:"stat-label"},"Images",-1))]),s("div",os,[s("div",ns,e(n.value.gifs),1),t[18]||(t[18]=s("div",{class:"stat-label"},"GIFs",-1))]),s("div",ds,[s("div",rs,e(n.value.videos),1),t[19]||(t[19]=s("div",{class:"stat-label"},"Videos",-1))]),s("div",us,[s("div",cs,e(n.value.total_size_formatted),1),t[20]||(t[20]=s("div",{class:"stat-label"},"Total Media Size",-1))]),s("div",vs,[s("div",gs,e(n.value.database_size_formatted),1),t[21]||(t[21]=s("div",{class:"stat-label"},"Database Size",-1))]),n.value.oldest_post?(o(),l("div",_s,[s("div",ps,e(b(n.value.oldest_post)),1),t[22]||(t[22]=s("div",{class:"stat-label"},"Oldest Post",-1))])):g("",!0),n.value.newest_post?(o(),l("div",fs,[s("div",ms,e(b(n.value.newest_post)),1),t[23]||(t[23]=s("div",{class:"stat-label"},"Newest Post",-1))])):g("",!0)]))])]))}},hs=x(ws,[["__scopeId","data-v-8f3dbfca"]]);export{hs as default};
