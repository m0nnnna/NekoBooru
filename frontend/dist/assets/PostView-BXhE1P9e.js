import{_ as I,r,c as V,k as j,j as U,s as Q,g as i,o as s,f as e,h as $,x as H,t as y,y as D,z as Z,b as ee,F as q,i as N,e as te,w as ae,A as oe,a as w,m as K,B as se,u as le,l as P,n as T,p as ne,q as ie}from"./index-DXYm_mhS.js";import{T as ue}from"./TagInput-DKky1N8C.js";const de=["src","alt"],re=["src"],ce={key:0,class:"error-state"},ve={class:"error-url"},me={key:1,class:"loading-state"},fe={key:2,class:"controls"},ye={class:"zoom-level"},pe={__name:"MediaViewer",props:{src:{type:String,required:!0},alt:{type:String,default:""},type:{type:String,default:"image"}},emits:["close"],setup(p,{emit:C}){const v=p,a=C;function g(){a("close")}const b=r(null),f=r(null),m=r(1),l=r(0),u=r(0),h=r(!1),x=r({x:0,y:0}),S=r({width:0,height:0}),_=r(!0),k=r(!1),F=V(()=>v.type==="image"||v.type==="gif"),L=V(()=>v.type==="video"),z=V(()=>({transform:`translate(calc(-50% + ${l.value}px), calc(-50% + ${u.value}px)) scale(${m.value})`,opacity:_.value||k.value?0:1}));function E(c){_.value=!1,k.value=!1;const d=c.target;S.value={width:d.naturalWidth,height:d.naturalHeight},Z(()=>A())}function R(c){_.value=!1,k.value=!1;const d=c.target;S.value={width:d.videoWidth,height:d.videoHeight},Z(()=>A())}function M(){_.value=!1,k.value=!0}function o(c){if(k.value)return;const d=c.deltaY>0?-.1:.1,B=Math.max(.1,Math.min(10,m.value+d));m.value=B}function t(c){c.button!==0||k.value||(h.value=!0,x.value={x:c.clientX-l.value,y:c.clientY-u.value})}function n(c){h.value&&(l.value=c.clientX-x.value.x,u.value=c.clientY-x.value.y)}function W(){h.value=!1}function O(){m.value=Math.min(10,m.value+.25)}function G(){m.value=Math.max(.1,m.value-.25)}function Y(){m.value=1,l.value=0,u.value=0}function A(){if(!b.value||!S.value.width)return;const c=b.value.getBoundingClientRect(),d=40,B=(c.width-d)/S.value.width,J=(c.height-d)/S.value.height;m.value=Math.min(B,J,1),l.value=0,u.value=0}j(()=>v.src,()=>{_.value=!0,k.value=!1,Y()});function X(c){c.key==="Escape"&&g()}return U(()=>{window.addEventListener("keydown",X)}),Q(()=>{window.removeEventListener("keydown",X)}),(c,d)=>(s(),i("div",{class:"media-viewer",ref_key:"containerRef",ref:b,onWheel:D(o,["prevent"]),onMousedown:t,onMousemove:n,onMouseup:W,onMouseleave:W},[e("div",{class:"media-wrapper",style:H(z.value)},[F.value?(s(),i("img",{key:0,src:p.src,alt:p.alt,onLoad:E,onError:M,draggable:"false",ref_key:"mediaRef",ref:f},null,40,de)):L.value?(s(),i("video",{key:1,src:p.src,controls:"",autoplay:"",loop:"",onLoadedmetadata:R,onError:M,ref_key:"mediaRef",ref:f},null,40,re)):$("",!0)],4),k.value?(s(),i("div",ce,[d[0]||(d[0]=e("span",{class:"error-icon"},"⚠",-1)),d[1]||(d[1]=e("p",null,"Failed to load media",-1)),e("p",ve,y(p.src),1)])):$("",!0),_.value?(s(),i("div",me,[...d[2]||(d[2]=[e("div",{class:"spinner"},null,-1),e("p",null,"Loading...",-1)])])):$("",!0),e("button",{class:"close-button",onClick:g,title:"Close (Esc)"},[...d[3]||(d[3]=[e("span",null,"×",-1)])]),!k.value&&!_.value?(s(),i("div",fe,[e("button",{onClick:G,title:"Zoom out"},"-"),e("span",ye,y(Math.round(m.value*100))+"%",1),e("button",{onClick:O,title:"Zoom in"},"+"),e("button",{onClick:Y,title:"Reset"},"1:1"),e("button",{onClick:A,title:"Fit to screen"},"Fit")])):$("",!0)],544))}},ge=I(pe,[["__scopeId","data-v-25a71b28"]]),be={class:"tag-list"},he={key:0},ke={class:"tags"},we={__name:"TagList",props:{tags:{type:Array,required:!0},title:{type:String,default:""},tagInfo:{type:Object,default:()=>({})}},setup(p){const C=p;function v(a){const g=C.tagInfo[a];return(g==null?void 0:g.categoryColor)||"var(--tag-general)"}return(a,g)=>{const b=ee("router-link");return s(),i("div",be,[p.title?(s(),i("h3",he,y(p.title),1)):$("",!0),e("div",ke,[(s(!0),i(q,null,N(p.tags,f=>(s(),te(b,{key:f,to:{path:"/",query:{q:f}},class:"tag",style:H({"--tag-color":v(f)})},{default:ae(()=>[oe(y(f),1)]),_:2},1032,["to","style"]))),128))])])}}},Ce=I(we,[["__scopeId","data-v-a24193c2"]]),_e={class:"comment-section"},$e=["disabled"],xe={class:"comments-list"},Se={class:"comment-content"},Fe={class:"comment-meta"},Me=["onClick"],Pe={key:0,class:"no-comments"},Te={__name:"CommentSection",props:{postId:{type:Number,required:!0}},setup(p){const C=p,v=r([]),a=r("");U(async()=>{await g()});async function g(){try{v.value=await w.getComments(C.postId)}catch(l){console.error("Failed to load comments:",l)}}async function b(){if(a.value.trim())try{const l=await w.createComment(C.postId,a.value);v.value.push(l),a.value=""}catch(l){alert("Failed to add comment: "+l.message)}}async function f(l){if(confirm("Delete this comment?"))try{await w.deleteComment(l),v.value=v.value.filter(u=>u.id!==l)}catch(u){alert("Failed to delete comment: "+u.message)}}function m(l){return new Date(l).toLocaleString()}return(l,u)=>(s(),i("div",_e,[e("h3",null,"Comments ("+y(v.value.length)+")",1),e("form",{onSubmit:D(b,["prevent"]),class:"comment-form"},[K(e("textarea",{"onUpdate:modelValue":u[0]||(u[0]=h=>a.value=h),placeholder:"Write a comment...",rows:"3"},null,512),[[se,a.value]]),e("button",{type:"submit",class:"btn",disabled:!a.value.trim()}," Post Comment ",8,$e)],32),e("div",xe,[(s(!0),i(q,null,N(v.value,h=>(s(),i("div",{key:h.id,class:"comment"},[e("div",Se,[e("p",null,y(h.text),1),e("div",Fe,[e("span",null,y(m(h.createdAt)),1),e("button",{onClick:x=>f(h.id),class:"delete-btn"}," Delete ",8,Me)])])]))),128)),v.value.length===0?(s(),i("div",Pe," No comments yet ")):$("",!0)])]))}},Ve=I(Te,[["__scopeId","data-v-ab9988d3"]]),De={key:0,class:"post-view"},Ie={class:"post-content"},Le={class:"media-container"},ze={class:"post-sidebar"},Ee={class:"sidebar-section"},Re={class:"info-list"},Ae={class:"safety-buttons"},Be={class:"sidebar-section"},Ue={class:"sidebar-section actions"},qe={class:"modal"},Ne={class:"modal-actions"},We={class:"modal"},Ye=["value"],Xe={class:"modal-actions"},Ze=["disabled"],je={key:1,class:"loading"},He={key:2,class:"error"},Ke={__name:"PostView",setup(p){const C=le(),v=ie(),a=r(null),g=r(!0),b=r(!1),f=r(!1),m=r([]),l=r([]),u=r(""),h=V(()=>{if(!a.value)return"image";const o=a.value.extension;return[".webm",".mp4"].includes(o)?"video":o===".gif"?"gif":"image"});U(async()=>{await x(),await S()}),j(()=>C.params.id,x);async function x(){g.value=!0;try{a.value=await w.getPost(C.params.id),m.value=[...a.value.tags]}catch{a.value=null}finally{g.value=!1}}async function S(){try{const o=await w.getPools();l.value=o.results}catch(o){console.error("Failed to load pools:",o)}}async function _(){try{const o=await w.toggleFavorite(a.value.id);a.value.isFavorited=o.isFavorited}catch(o){alert("Failed to toggle favorite: "+o.message)}}async function k(){try{a.value=await w.updatePost(a.value.id,{tags:m.value}),b.value=!1}catch(o){alert("Failed to save tags: "+o.message)}}async function F(o){if(a.value.safety===o)return;const t=a.value.safety;a.value.safety=o;try{await w.updatePost(a.value.id,{safety:o})}catch(n){alert("Failed to update safety: "+n.message),a.value.safety=t}}async function L(){if(u.value)try{await w.addPostsToPool(u.value,[a.value.id]),f.value=!1,u.value="",alert("Added to pool")}catch(o){alert("Failed to add to pool: "+o.message)}}async function z(){if(confirm("Are you sure you want to delete this post?"))try{await w.deletePost(a.value.id),v.push("/")}catch(o){alert("Failed to delete post: "+o.message)}}function E(){v.push("/")}function R(o){return o<1024?o+" B":o<1024*1024?(o/1024).toFixed(1)+" KB":(o/(1024*1024)).toFixed(1)+" MB"}function M(o){return new Date(o).toLocaleDateString()}return(o,t)=>a.value?(s(),i("div",De,[e("div",Ie,[e("div",Le,[P(ge,{src:a.value.contentUrl,alt:a.value.filename,type:h.value,onClose:E},null,8,["src","alt","type"])])]),e("aside",ze,[e("div",Ee,[t[17]||(t[17]=e("h3",null,"Info",-1)),e("dl",Re,[t[11]||(t[11]=e("dt",null,"ID",-1)),e("dd",null,y(a.value.id),1),t[12]||(t[12]=e("dt",null,"Size",-1)),e("dd",null,y(a.value.width)+" x "+y(a.value.height),1),t[13]||(t[13]=e("dt",null,"File size",-1)),e("dd",null,y(R(a.value.fileSize)),1),t[14]||(t[14]=e("dt",null,"Type",-1)),e("dd",null,y(a.value.extension),1),t[15]||(t[15]=e("dt",null,"Uploaded",-1)),e("dd",null,y(M(a.value.createdAt)),1),t[16]||(t[16]=e("dt",null,"Rating",-1)),e("dd",Ae,[e("button",{class:T(["safety-btn safe",{active:a.value.safety==="safe"}]),onClick:t[0]||(t[0]=n=>F("safe")),title:"Safe"},null,2),e("button",{class:T(["safety-btn sketchy",{active:a.value.safety==="sketchy"}]),onClick:t[1]||(t[1]=n=>F("sketchy")),title:"Sketchy"},null,2),e("button",{class:T(["safety-btn unsafe",{active:a.value.safety==="unsafe"}]),onClick:t[2]||(t[2]=n=>F("unsafe")),title:"Unsafe"},null,2)])])]),e("div",Be,[t[18]||(t[18]=e("h3",null,"Tags",-1)),P(Ce,{tags:a.value.tags},null,8,["tags"]),e("button",{class:"btn btn-secondary edit-tags-btn",onClick:t[3]||(t[3]=n=>b.value=!0)}," Edit Tags ")]),e("div",Ue,[e("button",{class:T(["btn",{"btn-danger":a.value.isFavorited}]),onClick:_},y(a.value.isFavorited?"Unfavorite":"Favorite"),3),e("button",{class:"btn btn-secondary",onClick:t[4]||(t[4]=n=>f.value=!0)}," Add to Pool "),e("button",{class:"btn btn-danger",onClick:z}," Delete ")]),P(Ve,{"post-id":a.value.id},null,8,["post-id"])]),b.value?(s(),i("div",{key:0,class:"modal-overlay",onClick:t[7]||(t[7]=D(n=>b.value=!1,["self"]))},[e("div",qe,[t[19]||(t[19]=e("h2",null,"Edit Tags",-1)),P(ue,{modelValue:m.value,"onUpdate:modelValue":t[5]||(t[5]=n=>m.value=n)},null,8,["modelValue"]),e("div",Ne,[e("button",{class:"btn btn-secondary",onClick:t[6]||(t[6]=n=>b.value=!1)},"Cancel"),e("button",{class:"btn",onClick:k},"Save")])])])):$("",!0),f.value?(s(),i("div",{key:1,class:"modal-overlay",onClick:t[10]||(t[10]=D(n=>f.value=!1,["self"]))},[e("div",We,[t[21]||(t[21]=e("h2",null,"Add to Pool",-1)),K(e("select",{"onUpdate:modelValue":t[8]||(t[8]=n=>u.value=n),class:"pool-select"},[t[20]||(t[20]=e("option",{value:""},"Select a pool...",-1)),(s(!0),i(q,null,N(l.value,n=>(s(),i("option",{key:n.id,value:n.id},y(n.name),9,Ye))),128))],512),[[ne,u.value]]),e("div",Xe,[e("button",{class:"btn btn-secondary",onClick:t[9]||(t[9]=n=>f.value=!1)},"Cancel"),e("button",{class:"btn",onClick:L,disabled:!u.value},"Add",8,Ze)])])])):$("",!0)])):g.value?(s(),i("div",je,"Loading...")):(s(),i("div",He,"Post not found"))}},Je=I(Ke,[["__scopeId","data-v-7136fdbf"]]);export{Je as default};
