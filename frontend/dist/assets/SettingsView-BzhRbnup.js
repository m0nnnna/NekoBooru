import{_ as I,r as d,j as z,a as m,g as l,f as s,h as g,m as U,B as E,A as b,t as a,n as S,o}from"./index-CMYoRPze.js";const Y={class:"settings-view"},q={class:"settings-section"},G={class:"form-group"},O={class:"path-input-group"},R={class:"help-text"},W={key:0,class:"migration-prompt"},j={class:"alert alert-warning"},X={class:"migration-info"},H={key:0,class:"migration-details"},J={key:0},K={key:1},Q={class:"form-actions"},Z=["disabled"],$={class:"settings-section"},ss={class:"form-group"},ts={class:"cookies-upload-area"},es={key:0,class:"cookies-configured"},as={key:1,class:"cookies-not-configured"},ls={class:"form-actions"},os=["disabled"],is=["disabled"],ns={class:"settings-section"},ds={class:"info-grid"},us={class:"info-item"},rs={class:"info-item"},cs={class:"info-item"},vs={class:"info-item"},gs={class:"settings-section"},fs={key:0,class:"stats-loading"},ps={key:1,class:"stats-error"},_s={key:2,class:"stats-grid"},ms={class:"stat-card"},ws={class:"stat-value"},ys={class:"stat-card"},ks={class:"stat-value"},hs={class:"stat-card"},bs={class:"stat-value"},Cs={class:"stat-card"},Ds={class:"stat-value"},Ss={class:"stat-card wide"},Fs={class:"stat-value"},xs={class:"stat-card wide"},Ns={class:"stat-value"},Ms={key:0,class:"stat-card wide"},Ls={class:"stat-value"},Ts={key:1,class:"stat-card wide"},Vs={class:"stat-value"},As={__name:"SettingsView",setup(Ps){const u=d({}),v=d(""),_=d(!1),F=d(navigator.platform.toLowerCase().includes("win")),C=d(null),p=d(!1),c=d({show:!1,success:!1,message:""}),r=d({}),k=d(!0),y=d(null),f=d({show:!1,old_path:"",new_path:""}),n=d({show:!1,success:!1,message:"",details:null});z(async()=>{await Promise.all([w(),x()])});async function x(){k.value=!0,y.value=null;try{r.value=await m.getStats()}catch(e){y.value="Failed to load statistics: "+e.message}finally{k.value=!1}}function D(e){return e?new Date(e).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A"}async function w(){try{u.value=await m.getSettings(),v.value=u.value.data_dir||""}catch(e){alert("Failed to load settings: "+e.message)}}async function N(){if(!v.value.trim()){alert("Please enter a data directory path");return}_.value=!0,f.show=!1,n.show=!1;try{const e=await m.updateDataDir(v.value.trim(),!1);e.needs_migration?f.value={show:!0,old_path:e.old_path,new_path:e.new_path}:(await w(),alert("Settings saved successfully!"))}catch(e){alert("Failed to save settings: "+e.message)}finally{_.value=!1}}async function M(){var e,t;_.value=!0,f.show=!1;try{const i=await m.updateDataDir(v.value.trim(),!0);n.value={show:!0,success:i.success||!1,message:i.message||(i.success?"Migration completed successfully":"Migration failed"),details:i.migration||null,files_copied:(e=i.migration)==null?void 0:e.files_copied,directories_copied:(t=i.migration)==null?void 0:t.directories_copied},i.success&&(await w(),setTimeout(()=>{window.location.reload()},2e3))}catch(i){n.value={show:!0,success:!1,message:"Migration failed: "+i.message,details:null}}finally{_.value=!1}}function L(){f.show=!1,v.value=u.value.data_dir||""}function T(){v.value=u.value.data_dir||"",f.show=!1,n.show=!1}function V(){alert("Directory browsing requires a native file picker. Please enter the path manually.")}function A(){var e;(e=C.value)==null||e.click()}async function P(e){var i;const t=(i=e.target.files)==null?void 0:i[0];if(t){p.value=!0,c.value.show=!1;try{const h=await m.uploadYtdlpCookies(t);c.value={show:!0,success:!0,message:h.message},await w()}catch(h){c.value={show:!0,success:!1,message:h.message}}finally{p.value=!1,e.target.value=""}}}async function B(){p.value=!0,c.value.show=!1;try{const e=await m.deleteYtdlpCookies();c.value={show:!0,success:!0,message:e.message},await w()}catch(e){c.value={show:!0,success:!1,message:e.message}}finally{p.value=!1}}return(e,t)=>(o(),l("div",Y,[t[30]||(t[30]=s("h1",null,"Settings",-1)),s("div",q,[t[9]||(t[9]=s("h2",null,"Data Storage",-1)),t[10]||(t[10]=s("p",{class:"section-description"}," Configure where NekoBooru stores your data (posts, thumbnails, database). Changing this location will migrate your existing data. ",-1)),s("div",G,[t[2]||(t[2]=s("label",null,"Data Directory",-1)),s("div",O,[U(s("input",{"onUpdate:modelValue":t[0]||(t[0]=i=>v.value=i),type:"text",placeholder:"Enter data directory path",class:"path-input"},null,512),[[E,v.value]]),F.value?g("",!0):(o(),l("button",{key:0,class:"btn btn-secondary",onClick:V}," Browse "))]),s("p",R,[t[1]||(t[1]=b(" Current: ",-1)),s("code",null,a(u.value.data_dir||"Loading..."),1)])]),f.value.show?(o(),l("div",W,[s("div",j,[t[7]||(t[7]=s("strong",null,"⚠️ Data Migration Required",-1)),t[8]||(t[8]=s("p",null," Data exists at the old location. Would you like to migrate it to the new location? ",-1)),s("div",X,[s("p",null,[t[3]||(t[3]=s("strong",null,"From:",-1)),t[4]||(t[4]=b()),s("code",null,a(f.value.old_path),1)]),s("p",null,[t[5]||(t[5]=s("strong",null,"To:",-1)),t[6]||(t[6]=b()),s("code",null,a(f.value.new_path),1)])]),s("div",{class:"migration-actions"},[s("button",{class:"btn",onClick:M},"Yes, Migrate Data"),s("button",{class:"btn btn-secondary",onClick:L},"Cancel")])])])):g("",!0),n.value.show?(o(),l("div",{key:1,class:S(["migration-status",n.value.success?"success":"error"])},[s("p",null,[s("strong",null,a(n.value.success?"✓":"✗")+" "+a(n.value.message),1)]),n.value.details?(o(),l("div",H,[n.value.files_copied!==void 0?(o(),l("p",J," Files copied: "+a(n.value.files_copied),1)):g("",!0),n.value.directories_copied!==void 0?(o(),l("p",K," Directories copied: "+a(n.value.directories_copied),1)):g("",!0)])):g("",!0)],2)):g("",!0),s("div",Q,[s("button",{class:"btn",onClick:N,disabled:!v.value.trim()||_.value},a(_.value?"Saving...":"Save Settings"),9,Z),s("button",{class:"btn btn-secondary",onClick:T},"Reset")])]),s("div",$,[t[14]||(t[14]=s("h2",null,"Video Downloads (yt-dlp)",-1)),t[15]||(t[15]=s("p",{class:"section-description"},' Configure cookies for downloading age-restricted or login-required videos from platforms like X/Twitter. Export cookies from your browser using an extension like "Get cookies.txt LOCALLY" and upload the file here. ',-1)),s("div",ss,[t[13]||(t[13]=s("label",null,"Cookies File",-1)),s("div",ts,[u.value.ytdlp_cookies_configured?(o(),l("div",es,[...t[11]||(t[11]=[s("span",{class:"cookies-status-icon success"},"✓",-1),s("span",null,"Cookies file uploaded",-1)])])):(o(),l("div",as,[...t[12]||(t[12]=[s("span",{class:"cookies-status-icon"},"✗",-1),s("span",null,"No cookies file uploaded",-1)])]))]),s("input",{ref_key:"cookiesFileInput",ref:C,type:"file",accept:".txt",onChange:P,style:{display:"none"}},null,544)]),c.value.show?(o(),l("div",{key:0,class:S(["cookies-status",c.value.success?"success":"error"])},[s("p",null,[s("strong",null,a(c.value.success?"✓":"✗")+" "+a(c.value.message),1)])],2)):g("",!0),s("div",ls,[s("button",{class:"btn",onClick:A,disabled:p.value},a(p.value?"Uploading...":"Upload Cookies File"),9,os),s("button",{class:"btn btn-secondary",onClick:B,disabled:p.value||!u.value.ytdlp_cookies_configured}," Delete ",8,is)])]),s("div",ns,[t[20]||(t[20]=s("h2",null,"Directory Information",-1)),s("div",ds,[s("div",us,[t[16]||(t[16]=s("label",null,"Database",-1)),s("code",null,a(u.value.database_path||"N/A"),1)]),s("div",rs,[t[17]||(t[17]=s("label",null,"Posts",-1)),s("code",null,a(u.value.posts_dir||"N/A"),1)]),s("div",cs,[t[18]||(t[18]=s("label",null,"Thumbnails",-1)),s("code",null,a(u.value.thumbs_dir||"N/A"),1)]),s("div",vs,[t[19]||(t[19]=s("label",null,"Uploads",-1)),s("code",null,a(u.value.uploads_dir||"N/A"),1)])])]),s("div",gs,[t[29]||(t[29]=s("h2",null,"Server Statistics",-1)),k.value?(o(),l("div",fs,"Loading statistics...")):y.value?(o(),l("div",ps,a(y.value),1)):(o(),l("div",_s,[s("div",ms,[s("div",ws,a(r.value.total_files),1),t[21]||(t[21]=s("div",{class:"stat-label"},"Total Files",-1))]),s("div",ys,[s("div",ks,a(r.value.images),1),t[22]||(t[22]=s("div",{class:"stat-label"},"Images",-1))]),s("div",hs,[s("div",bs,a(r.value.gifs),1),t[23]||(t[23]=s("div",{class:"stat-label"},"GIFs",-1))]),s("div",Cs,[s("div",Ds,a(r.value.videos),1),t[24]||(t[24]=s("div",{class:"stat-label"},"Videos",-1))]),s("div",Ss,[s("div",Fs,a(r.value.total_size_formatted),1),t[25]||(t[25]=s("div",{class:"stat-label"},"Total Media Size",-1))]),s("div",xs,[s("div",Ns,a(r.value.database_size_formatted),1),t[26]||(t[26]=s("div",{class:"stat-label"},"Database Size",-1))]),r.value.oldest_post?(o(),l("div",Ms,[s("div",Ls,a(D(r.value.oldest_post)),1),t[27]||(t[27]=s("div",{class:"stat-label"},"Oldest Post",-1))])):g("",!0),r.value.newest_post?(o(),l("div",Ts,[s("div",Vs,a(D(r.value.newest_post)),1),t[28]||(t[28]=s("div",{class:"stat-label"},"Newest Post",-1))])):g("",!0)]))])]))}},Is=I(As,[["__scopeId","data-v-2955035b"]]);export{Is as default};
