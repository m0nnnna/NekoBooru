import{_ as P,r,c as S,k as X,j as R,p as J,g as l,o as s,f as e,h as $,q as Z,t as p,s as T,x as Y,b as Q,F as B,i as U,e as ee,w as te,y as oe,a as C,m as j,z as ae,u as se,l as M,A as ne,v as le,n as ie}from"./index-BkOaPNou.js";import{T as ue}from"./TagInput-D5C8BvIE.js";const re=["src","alt"],de=["src"],ce={key:0,class:"error-state"},ve={class:"error-url"},me={key:1,class:"loading-state"},fe={key:2,class:"controls"},pe={class:"zoom-level"},ge={__name:"MediaViewer",props:{src:{type:String,required:!0},alt:{type:String,default:""},type:{type:String,default:"image"}},emits:["close"],setup(g,{emit:b}){const c=g,o=b;function y(){o("close")}const h=r(null),m=r(null),v=r(1),n=r(0),i=r(0),w=r(!1),x=r({x:0,y:0}),F=r({width:0,height:0}),k=r(!0),_=r(!1),V=S(()=>c.type==="image"||c.type==="gif"),D=S(()=>c.type==="video"),I=S(()=>({transform:`translate(calc(-50% + ${n.value}px), calc(-50% + ${i.value}px)) scale(${v.value})`,opacity:k.value||_.value?0:1}));function L(d){k.value=!1,_.value=!1;const u=d.target;F.value={width:u.naturalWidth,height:u.naturalHeight},Y(()=>E())}function z(d){k.value=!1,_.value=!1;const u=d.target;F.value={width:u.videoWidth,height:u.videoHeight},Y(()=>E())}function a(){k.value=!1,_.value=!0}function t(d){if(_.value)return;const u=d.deltaY>0?-.1:.1,A=Math.max(.1,Math.min(10,v.value+u));v.value=A}function f(d){d.button!==0||_.value||(w.value=!0,x.value={x:d.clientX-n.value,y:d.clientY-i.value})}function H(d){w.value&&(n.value=d.clientX-x.value.x,i.value=d.clientY-x.value.y)}function q(){w.value=!1}function K(){v.value=Math.min(10,v.value+.25)}function O(){v.value=Math.max(.1,v.value-.25)}function N(){v.value=1,n.value=0,i.value=0}function E(){if(!h.value||!F.value.width)return;const d=h.value.getBoundingClientRect(),u=40,A=(d.width-u)/F.value.width,G=(d.height-u)/F.value.height;v.value=Math.min(A,G,1),n.value=0,i.value=0}X(()=>c.src,()=>{k.value=!0,_.value=!1,N()});function W(d){d.key==="Escape"&&y()}return R(()=>{window.addEventListener("keydown",W)}),J(()=>{window.removeEventListener("keydown",W)}),(d,u)=>(s(),l("div",{class:"media-viewer",ref_key:"containerRef",ref:h,onWheel:T(t,["prevent"]),onMousedown:f,onMousemove:H,onMouseup:q,onMouseleave:q},[e("div",{class:"media-wrapper",style:Z(I.value)},[V.value?(s(),l("img",{key:0,src:g.src,alt:g.alt,onLoad:L,onError:a,draggable:"false",ref_key:"mediaRef",ref:m},null,40,re)):D.value?(s(),l("video",{key:1,src:g.src,controls:"",autoplay:"",loop:"",onLoadedmetadata:z,onError:a,ref_key:"mediaRef",ref:m},null,40,de)):$("",!0)],4),_.value?(s(),l("div",ce,[u[0]||(u[0]=e("span",{class:"error-icon"},"⚠",-1)),u[1]||(u[1]=e("p",null,"Failed to load media",-1)),e("p",ve,p(g.src),1)])):$("",!0),k.value?(s(),l("div",me,[...u[2]||(u[2]=[e("div",{class:"spinner"},null,-1),e("p",null,"Loading...",-1)])])):$("",!0),e("button",{class:"close-button",onClick:y,title:"Close (Esc)"},[...u[3]||(u[3]=[e("span",null,"×",-1)])]),!_.value&&!k.value?(s(),l("div",fe,[e("button",{onClick:O,title:"Zoom out"},"-"),e("span",pe,p(Math.round(v.value*100))+"%",1),e("button",{onClick:K,title:"Zoom in"},"+"),e("button",{onClick:N,title:"Reset"},"1:1"),e("button",{onClick:E,title:"Fit to screen"},"Fit")])):$("",!0)],544))}},ye=P(ge,[["__scopeId","data-v-c578396b"]]),he={class:"tag-list"},we={key:0},_e={class:"tags"},be={__name:"TagList",props:{tags:{type:Array,required:!0},title:{type:String,default:""},tagInfo:{type:Object,default:()=>({})}},setup(g){const b=g;function c(o){const y=b.tagInfo[o];return(y==null?void 0:y.categoryColor)||"var(--tag-general)"}return(o,y)=>{const h=Q("router-link");return s(),l("div",he,[g.title?(s(),l("h3",we,p(g.title),1)):$("",!0),e("div",_e,[(s(!0),l(B,null,U(g.tags,m=>(s(),ee(h,{key:m,to:{path:"/",query:{q:m}},class:"tag",style:Z({"--tag-color":c(m)})},{default:te(()=>[oe(p(m),1)]),_:2},1032,["to","style"]))),128))])])}}},ke=P(be,[["__scopeId","data-v-5d453c99"]]),Ce={class:"comment-section"},$e=["disabled"],xe={class:"comments-list"},Fe={class:"comment-content"},Me={class:"comment-meta"},Se=["onClick"],Te={key:0,class:"no-comments"},Pe={__name:"CommentSection",props:{postId:{type:Number,required:!0}},setup(g){const b=g,c=r([]),o=r("");R(async()=>{await y()});async function y(){try{c.value=await C.getComments(b.postId)}catch(n){console.error("Failed to load comments:",n)}}async function h(){if(o.value.trim())try{const n=await C.createComment(b.postId,o.value);c.value.push(n),o.value=""}catch(n){alert("Failed to add comment: "+n.message)}}async function m(n){if(confirm("Delete this comment?"))try{await C.deleteComment(n),c.value=c.value.filter(i=>i.id!==n)}catch(i){alert("Failed to delete comment: "+i.message)}}function v(n){return new Date(n).toLocaleString()}return(n,i)=>(s(),l("div",Ce,[e("h3",null,"Comments ("+p(c.value.length)+")",1),e("form",{onSubmit:T(h,["prevent"]),class:"comment-form"},[j(e("textarea",{"onUpdate:modelValue":i[0]||(i[0]=w=>o.value=w),placeholder:"Write a comment...",rows:"3"},null,512),[[ae,o.value]]),e("button",{type:"submit",class:"btn",disabled:!o.value.trim()}," Post Comment ",8,$e)],32),e("div",xe,[(s(!0),l(B,null,U(c.value,w=>(s(),l("div",{key:w.id,class:"comment"},[e("div",Fe,[e("p",null,p(w.text),1),e("div",Me,[e("span",null,p(v(w.createdAt)),1),e("button",{onClick:x=>m(w.id),class:"delete-btn"}," Delete ",8,Se)])])]))),128)),c.value.length===0?(s(),l("div",Te," No comments yet ")):$("",!0)])]))}},Ve=P(Pe,[["__scopeId","data-v-f5d5b512"]]),De={key:0,class:"post-view"},Ie={class:"post-content"},Le={class:"media-container"},ze={class:"post-sidebar"},Ee={class:"sidebar-section"},Ae={class:"info-list"},Re={class:"sidebar-section"},Be={class:"sidebar-section actions"},Ue={class:"modal"},qe={class:"modal-actions"},Ne={class:"modal"},We=["value"],Ye={class:"modal-actions"},Xe=["disabled"],Ze={key:1,class:"loading"},je={key:2,class:"error"},He={__name:"PostView",setup(g){const b=se(),c=ie(),o=r(null),y=r(!0),h=r(!1),m=r(!1),v=r([]),n=r([]),i=r(""),w=S(()=>{if(!o.value)return"image";const a=o.value.extension;return[".webm",".mp4"].includes(a)?"video":a===".gif"?"gif":"image"});R(async()=>{await x(),await F()}),X(()=>b.params.id,x);async function x(){y.value=!0;try{o.value=await C.getPost(b.params.id),v.value=[...o.value.tags]}catch{o.value=null}finally{y.value=!1}}async function F(){try{const a=await C.getPools();n.value=a.results}catch(a){console.error("Failed to load pools:",a)}}async function k(){try{const a=await C.toggleFavorite(o.value.id);o.value.isFavorited=a.isFavorited}catch(a){alert("Failed to toggle favorite: "+a.message)}}async function _(){try{o.value=await C.updatePost(o.value.id,{tags:v.value}),h.value=!1}catch(a){alert("Failed to save tags: "+a.message)}}async function V(){if(i.value)try{await C.addPostsToPool(i.value,[o.value.id]),m.value=!1,i.value="",alert("Added to pool")}catch(a){alert("Failed to add to pool: "+a.message)}}async function D(){if(confirm("Are you sure you want to delete this post?"))try{await C.deletePost(o.value.id),c.push("/")}catch(a){alert("Failed to delete post: "+a.message)}}function I(){c.push("/")}function L(a){return a<1024?a+" B":a<1024*1024?(a/1024).toFixed(1)+" KB":(a/(1024*1024)).toFixed(1)+" MB"}function z(a){return new Date(a).toLocaleDateString()}return(a,t)=>o.value?(s(),l("div",De,[e("div",Ie,[e("div",Le,[M(ye,{src:o.value.contentUrl,alt:o.value.filename,type:w.value,onClose:I},null,8,["src","alt","type"])])]),e("aside",ze,[e("div",Ee,[t[13]||(t[13]=e("h3",null,"Info",-1)),e("dl",Ae,[t[8]||(t[8]=e("dt",null,"ID",-1)),e("dd",null,p(o.value.id),1),t[9]||(t[9]=e("dt",null,"Size",-1)),e("dd",null,p(o.value.width)+" x "+p(o.value.height),1),t[10]||(t[10]=e("dt",null,"File size",-1)),e("dd",null,p(L(o.value.fileSize)),1),t[11]||(t[11]=e("dt",null,"Type",-1)),e("dd",null,p(o.value.extension),1),t[12]||(t[12]=e("dt",null,"Uploaded",-1)),e("dd",null,p(z(o.value.createdAt)),1)])]),e("div",Re,[t[14]||(t[14]=e("h3",null,"Tags",-1)),M(ke,{tags:o.value.tags},null,8,["tags"]),e("button",{class:"btn btn-secondary edit-tags-btn",onClick:t[0]||(t[0]=f=>h.value=!0)}," Edit Tags ")]),e("div",Be,[e("button",{class:ne(["btn",{"btn-danger":o.value.isFavorited}]),onClick:k},p(o.value.isFavorited?"Unfavorite":"Favorite"),3),e("button",{class:"btn btn-secondary",onClick:t[1]||(t[1]=f=>m.value=!0)}," Add to Pool "),e("button",{class:"btn btn-danger",onClick:D}," Delete ")]),M(Ve,{"post-id":o.value.id},null,8,["post-id"])]),h.value?(s(),l("div",{key:0,class:"modal-overlay",onClick:t[4]||(t[4]=T(f=>h.value=!1,["self"]))},[e("div",Ue,[t[15]||(t[15]=e("h2",null,"Edit Tags",-1)),M(ue,{modelValue:v.value,"onUpdate:modelValue":t[2]||(t[2]=f=>v.value=f)},null,8,["modelValue"]),e("div",qe,[e("button",{class:"btn btn-secondary",onClick:t[3]||(t[3]=f=>h.value=!1)},"Cancel"),e("button",{class:"btn",onClick:_},"Save")])])])):$("",!0),m.value?(s(),l("div",{key:1,class:"modal-overlay",onClick:t[7]||(t[7]=T(f=>m.value=!1,["self"]))},[e("div",Ne,[t[17]||(t[17]=e("h2",null,"Add to Pool",-1)),j(e("select",{"onUpdate:modelValue":t[5]||(t[5]=f=>i.value=f),class:"pool-select"},[t[16]||(t[16]=e("option",{value:""},"Select a pool...",-1)),(s(!0),l(B,null,U(n.value,f=>(s(),l("option",{key:f.id,value:f.id},p(f.name),9,We))),128))],512),[[le,i.value]]),e("div",Ye,[e("button",{class:"btn btn-secondary",onClick:t[6]||(t[6]=f=>m.value=!1)},"Cancel"),e("button",{class:"btn",onClick:V,disabled:!i.value},"Add",8,Xe)])])])):$("",!0)])):y.value?(s(),l("div",Ze,"Loading...")):(s(),l("div",je,"Post not found"))}},Ge=P(He,[["__scopeId","data-v-07c4897f"]]);export{Ge as default};
