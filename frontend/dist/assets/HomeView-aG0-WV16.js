import{d as U,r as l,c as C,a as $,_ as V,b as D,e as S,o as v,w as G,f as d,g as m,h as P,F as j,i as z,j as E,u as M,k as O,l as I,t as R,m as x,v as B,n as H}from"./index-RZanqM8g.js";import{P as L}from"./Pagination-DoXIwmrs.js";const A=U("posts",()=>{const t=l([]),e=l(null),y=l(0),o=l(1),p=l(40),f=l(""),n=l(!1),c=l(null),k=C(()=>Math.ceil(y.value/p.value));async function b(s={}){n.value=!0,c.value=null;try{const i=await $.getPosts({q:f.value,page:o.value,limit:p.value,...s});t.value=i.results,y.value=i.total}catch(i){c.value=i.message}finally{n.value=!1}}async function q(s){n.value=!0,c.value=null;try{e.value=await $.getPost(s)}catch(i){c.value=i.message}finally{n.value=!1}}async function h(s,i){var r;try{const g=await $.updatePost(s,i);((r=e.value)==null?void 0:r.id)===s&&(e.value=g);const w=t.value.findIndex(N=>N.id===s);return w!==-1&&(t.value[w]=g),g}catch(g){throw c.value=g.message,g}}async function F(s){var i;try{await $.deletePost(s),t.value=t.value.filter(r=>r.id!==s),((i=e.value)==null?void 0:i.id)===s&&(e.value=null)}catch(r){throw c.value=r.message,r}}async function a(s){var i;try{const r=await $.toggleFavorite(s);((i=e.value)==null?void 0:i.id)===s&&(e.value.isFavorited=r.isFavorited);const g=t.value.find(w=>w.id===s);return g&&(g.isFavorited=r.isFavorited),r.isFavorited}catch(r){throw c.value=r.message,r}}function u(s){f.value=s,o.value=1}function _(s){o.value=s}return{posts:t,currentPost:e,total:y,page:o,limit:p,pages:k,query:f,loading:n,error:c,fetchPosts:b,fetchPost:q,updatePost:h,deletePost:F,toggleFavorite:a,setQuery:u,setPage:_}}),J={class:"thumb-container"},K=["src","alt"],Q={key:0,class:"badge video-badge"},T={key:1,class:"badge gif-badge"},W={key:2,class:"badge fav-badge"},X={__name:"PostCard",props:{post:{type:Object,required:!0}},setup(t){const e=t,y=C(()=>[".webm",".mp4"].includes(e.post.extension)),o=C(()=>e.post.extension===".gif");function p(f){f.target.style.opacity="0.5"}return(f,n)=>{const c=D("router-link");return v(),S(c,{to:`/post/${t.post.id}`,class:"post-card"},{default:G(()=>[d("div",J,[d("img",{src:t.post.thumbUrl,alt:t.post.filename,loading:"lazy",onError:p},null,40,K),y.value?(v(),m("div",Q,"►")):P("",!0),o.value?(v(),m("div",T,"GIF")):P("",!0),t.post.isFavorited?(v(),m("div",W,"♥")):P("",!0)])]),_:1},8,["to"])}}},Y=V(X,[["__scopeId","data-v-58e887ed"]]),Z={class:"post-grid"},ee={key:0,class:"empty-state"},te={key:1,class:"loading-state"},se={__name:"PostGrid",props:{posts:{type:Array,required:!0},loading:{type:Boolean,default:!1}},emits:["select"],setup(t){return(e,y)=>(v(),m("div",Z,[(v(!0),m(j,null,z(t.posts,o=>(v(),S(Y,{key:o.id,post:o,onClick:p=>e.$emit("select",o)},null,8,["post","onClick"]))),128)),t.posts.length===0&&!t.loading?(v(),m("div",ee," No posts found ")):P("",!0),t.loading?(v(),m("div",te," Loading... ")):P("",!0)]))}},ae=V(se,[["__scopeId","data-v-b0fa3082"]]),oe={class:"home-view"},le={class:"toolbar"},ne={key:0,class:"result-count"},ue={class:"sort-controls"},ie={__name:"HomeView",setup(t){const e=M(),y=H(),o=A(),p=l("date"),f=l("desc"),n=l(1),c=l([]),k=l(0),b=l(0),q=l(!1);E(()=>{e.query.q&&o.setQuery(e.query.q),e.query.page&&(n.value=parseInt(e.query.page)||1),h()}),O(()=>e.query,a=>{a.q!==o.query&&o.setQuery(a.q||""),a.page?n.value=parseInt(a.page)||1:n.value=1,h()});async function h(){q.value=!0;try{const a=await fetch(`/api/posts?q=${encodeURIComponent(o.query)}&page=${n.value}&sort=${p.value}&order=${f.value}`).then(u=>u.json());c.value=a.results,k.value=a.total,b.value=a.pages}catch(a){console.error("Failed to fetch posts:",a)}finally{q.value=!1}}function F(a){n.value=a,y.push({query:{...e.query,page:a>1?a:void 0}}),h()}return(a,u)=>(v(),m("div",oe,[d("div",le,[q.value?P("",!0):(v(),m("div",ne,R(k.value)+" posts found ",1)),d("div",ue,[x(d("select",{"onUpdate:modelValue":u[0]||(u[0]=_=>p.value=_),onChange:h},[...u[3]||(u[3]=[d("option",{value:"date"},"Date",-1),d("option",{value:"id"},"ID",-1),d("option",{value:"size"},"Size",-1)])],544),[[B,p.value]]),x(d("select",{"onUpdate:modelValue":u[1]||(u[1]=_=>f.value=_),onChange:h},[...u[4]||(u[4]=[d("option",{value:"desc"},"Newest first",-1),d("option",{value:"asc"},"Oldest first",-1)])],544),[[B,f.value]])])]),I(ae,{posts:c.value,loading:q.value},null,8,["posts","loading"]),I(L,{modelValue:n.value,"onUpdate:modelValue":[u[2]||(u[2]=_=>n.value=_),F],pages:b.value},null,8,["modelValue","pages"])]))}},de=V(ie,[["__scopeId","data-v-6f610e66"]]);export{de as default};
