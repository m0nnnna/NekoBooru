import{_ as X,r as d,c as Y,k as K,j as B,s as ne,g as v,o as u,f as e,h as S,x as O,t as h,y as M,z as H,b as le,F as U,i as q,e as se,w as ie,A as ue,a as _,m as G,B as ce,u as re,l as F,n as P,p as de,q as ve}from"./index-CMYoRPze.js";import{T as fe}from"./TagInput-Bq-cmlCb.js";const me=["src","alt"],ge=["src"],he={key:0,class:"error-state"},ye={class:"error-url"},pe={key:1,class:"loading-state"},be={key:2,class:"controls"},ke={class:"zoom-level"},we={__name:"MediaViewer",props:{src:{type:String,required:!0},alt:{type:String,default:""},type:{type:String,default:"image"}},emits:["close"],setup(y,{emit:T}){const m=y,a=T;function p(){a("close")}const b=d(null),g=d(null),f=d(1),i=d(0),c=d(0),w=d(!1),x=d({x:0,y:0}),D=d({width:0,height:0}),$=d(!0),k=d(!1),l=d({initialDistance:0,initialScale:1,isPinching:!1,lastTouchX:0,lastTouchY:0,isTouchDragging:!1}),V=Y(()=>m.type==="image"||m.type==="gif"),I=Y(()=>m.type==="video"),L=Y(()=>({transform:`translate(calc(-50% + ${i.value}px), calc(-50% + ${c.value}px)) scale(${f.value})`,opacity:$.value||k.value?0:1}));function E(o){$.value=!1,k.value=!1;const s=o.target;D.value={width:s.naturalWidth,height:s.naturalHeight},H(()=>R())}function z(o){$.value=!1,k.value=!1;const s=o.target;D.value={width:s.videoWidth,height:s.videoHeight},H(()=>R())}function n(){$.value=!1,k.value=!0}function t(o){if(k.value)return;const s=o.deltaY>0?-.1:.1,C=Math.max(.1,Math.min(10,f.value+s));f.value=C}function r(o){o.button!==0||k.value||(w.value=!0,x.value={x:o.clientX-i.value,y:o.clientY-c.value})}function J(o){w.value&&(i.value=o.clientX-x.value.x,c.value=o.clientY-x.value.y)}function N(){w.value=!1}function W(o){const s=o[0].clientX-o[1].clientX,C=o[0].clientY-o[1].clientY;return Math.sqrt(s*s+C*C)}function Q(o){k.value||(o.touches.length===2?(l.value.isPinching=!0,l.value.isTouchDragging=!1,l.value.initialDistance=W(o.touches),l.value.initialScale=f.value):o.touches.length===1&&(l.value.isTouchDragging=!0,l.value.isPinching=!1,l.value.lastTouchX=o.touches[0].clientX,l.value.lastTouchY=o.touches[0].clientY))}function ee(o){if(!k.value){if(l.value.isPinching&&o.touches.length===2){const C=W(o.touches)/l.value.initialDistance,A=l.value.initialScale*C;f.value=Math.max(.1,Math.min(10,A))}else if(l.value.isTouchDragging&&o.touches.length===1){const s=o.touches[0].clientX-l.value.lastTouchX,C=o.touches[0].clientY-l.value.lastTouchY;i.value+=s,c.value+=C,l.value.lastTouchX=o.touches[0].clientX,l.value.lastTouchY=o.touches[0].clientY}}}function te(o){o.touches.length===0?(l.value.isPinching=!1,l.value.isTouchDragging=!1):o.touches.length===1&&(l.value.isPinching=!1,l.value.isTouchDragging=!0,l.value.lastTouchX=o.touches[0].clientX,l.value.lastTouchY=o.touches[0].clientY)}function ae(){f.value=Math.min(10,f.value+.25)}function oe(){f.value=Math.max(.1,f.value-.25)}function Z(){f.value=1,i.value=0,c.value=0}function R(){if(!b.value||!D.value.width)return;const o=b.value.getBoundingClientRect(),s=40,C=(o.width-s)/D.value.width,A=(o.height-s)/D.value.height;f.value=Math.min(C,A,1),i.value=0,c.value=0}K(()=>m.src,()=>{$.value=!0,k.value=!1,Z()});function j(o){o.key==="Escape"&&p()}return B(()=>{window.addEventListener("keydown",j)}),ne(()=>{window.removeEventListener("keydown",j)}),(o,s)=>(u(),v("div",{class:"media-viewer",ref_key:"containerRef",ref:b,onWheel:M(t,["prevent"]),onMousedown:r,onMousemove:J,onMouseup:N,onMouseleave:N,onTouchstart:Q,onTouchmove:M(ee,["prevent"]),onTouchend:te},[e("div",{class:"media-wrapper",style:O(L.value)},[V.value?(u(),v("img",{key:0,src:y.src,alt:y.alt,onLoad:E,onError:n,draggable:"false",ref_key:"mediaRef",ref:g},null,40,me)):I.value?(u(),v("video",{key:1,src:y.src,controls:"",autoplay:"",loop:"",onLoadedmetadata:z,onError:n,ref_key:"mediaRef",ref:g},null,40,ge)):S("",!0)],4),k.value?(u(),v("div",he,[s[0]||(s[0]=e("span",{class:"error-icon"},"âš ",-1)),s[1]||(s[1]=e("p",null,"Failed to load media",-1)),e("p",ye,h(y.src),1)])):S("",!0),$.value?(u(),v("div",pe,[...s[2]||(s[2]=[e("div",{class:"spinner"},null,-1),e("p",null,"Loading...",-1)])])):S("",!0),e("button",{class:"close-button",onClick:p,title:"Close (Esc)"},[...s[3]||(s[3]=[e("span",null,"Ã—",-1)])]),!k.value&&!$.value?(u(),v("div",be,[e("button",{onClick:oe,title:"Zoom out"},"-"),e("span",ke,h(Math.round(f.value*100))+"%",1),e("button",{onClick:ae,title:"Zoom in"},"+"),e("button",{onClick:Z,title:"Reset"},"1:1"),e("button",{onClick:R,title:"Fit to screen"},"Fit")])):S("",!0)],544))}},Ce=X(we,[["__scopeId","data-v-a98e27d5"]]),_e={class:"tag-list"},Te={key:0},$e={class:"tags"},Se={__name:"TagList",props:{tags:{type:Array,required:!0},title:{type:String,default:""},tagInfo:{type:Object,default:()=>({})}},setup(y){const T=y;function m(a){const p=T.tagInfo[a];return(p==null?void 0:p.categoryColor)||"var(--tag-general)"}return(a,p)=>{const b=le("router-link");return u(),v("div",_e,[y.title?(u(),v("h3",Te,h(y.title),1)):S("",!0),e("div",$e,[(u(!0),v(U,null,q(y.tags,g=>(u(),se(b,{key:g,to:{path:"/",query:{q:g}},class:"tag",style:O({"--tag-color":m(g)})},{default:ie(()=>[ue(h(g),1)]),_:2},1032,["to","style"]))),128))])])}}},xe=X(Se,[["__scopeId","data-v-5d453c99"]]),De={class:"comment-section"},Me=["disabled"],Fe={class:"comments-list"},Pe={class:"comment-content"},Ye={class:"comment-meta"},Xe=["onClick"],Ve={key:0,class:"no-comments"},Ie={__name:"CommentSection",props:{postId:{type:Number,required:!0}},setup(y){const T=y,m=d([]),a=d("");B(async()=>{await p()});async function p(){try{m.value=await _.getComments(T.postId)}catch(i){console.error("Failed to load comments:",i)}}async function b(){if(a.value.trim())try{const i=await _.createComment(T.postId,a.value);m.value.push(i),a.value=""}catch(i){alert("Failed to add comment: "+i.message)}}async function g(i){if(confirm("Delete this comment?"))try{await _.deleteComment(i),m.value=m.value.filter(c=>c.id!==i)}catch(c){alert("Failed to delete comment: "+c.message)}}function f(i){return new Date(i).toLocaleString()}return(i,c)=>(u(),v("div",De,[e("h3",null,"Comments ("+h(m.value.length)+")",1),e("form",{onSubmit:M(b,["prevent"]),class:"comment-form"},[G(e("textarea",{"onUpdate:modelValue":c[0]||(c[0]=w=>a.value=w),placeholder:"Write a comment...",rows:"3"},null,512),[[ce,a.value]]),e("button",{type:"submit",class:"btn",disabled:!a.value.trim()}," Post Comment ",8,Me)],32),e("div",Fe,[(u(!0),v(U,null,q(m.value,w=>(u(),v("div",{key:w.id,class:"comment"},[e("div",Pe,[e("p",null,h(w.text),1),e("div",Ye,[e("span",null,h(f(w.createdAt)),1),e("button",{onClick:x=>g(w.id),class:"delete-btn"}," Delete ",8,Xe)])])]))),128)),m.value.length===0?(u(),v("div",Ve," No comments yet ")):S("",!0)])]))}},Le=X(Ie,[["__scopeId","data-v-f5d5b512"]]),Ee={key:0,class:"post-view"},ze={class:"post-content"},Re={class:"media-container"},Ae={class:"post-sidebar"},Be={class:"sidebar-section"},Ue={class:"info-list"},qe={class:"safety-buttons"},Ne={class:"sidebar-section"},We={class:"sidebar-section actions"},Ze={class:"modal"},je={class:"modal-actions"},He={class:"modal"},Ke=["value"],Oe={class:"modal-actions"},Ge=["disabled"],Je={key:1,class:"loading"},Qe={key:2,class:"error"},et={__name:"PostView",setup(y){const T=re(),m=ve(),a=d(null),p=d(!0),b=d(!1),g=d(!1),f=d([]),i=d([]),c=d(""),w=Y(()=>{if(!a.value)return"image";const n=a.value.extension;return[".webm",".mp4"].includes(n)?"video":n===".gif"?"gif":"image"});B(async()=>{await x(),await D()}),K(()=>T.params.id,x);async function x(){p.value=!0;try{a.value=await _.getPost(T.params.id),f.value=[...a.value.tags]}catch{a.value=null}finally{p.value=!1}}async function D(){try{const n=await _.getPools();i.value=n.results}catch(n){console.error("Failed to load pools:",n)}}async function $(){try{const n=await _.toggleFavorite(a.value.id);a.value.isFavorited=n.isFavorited}catch(n){alert("Failed to toggle favorite: "+n.message)}}async function k(){try{a.value=await _.updatePost(a.value.id,{tags:f.value}),b.value=!1}catch(n){alert("Failed to save tags: "+n.message)}}async function l(n){if(a.value.safety===n)return;const t=a.value.safety;a.value.safety=n;try{await _.updatePost(a.value.id,{safety:n})}catch(r){alert("Failed to update safety: "+r.message),a.value.safety=t}}async function V(){if(c.value)try{await _.addPostsToPool(c.value,[a.value.id]),g.value=!1,c.value="",alert("Added to pool")}catch(n){alert("Failed to add to pool: "+n.message)}}async function I(){if(confirm("Are you sure you want to delete this post?"))try{await _.deletePost(a.value.id),m.back()}catch(n){alert("Failed to delete post: "+n.message)}}function L(){m.back()}function E(n){return n<1024?n+" B":n<1024*1024?(n/1024).toFixed(1)+" KB":(n/(1024*1024)).toFixed(1)+" MB"}function z(n){return new Date(n).toLocaleDateString()}return(n,t)=>a.value?(u(),v("div",Ee,[e("div",ze,[e("div",Re,[F(Ce,{src:a.value.contentUrl,alt:a.value.filename,type:w.value,onClose:L},null,8,["src","alt","type"])])]),e("aside",Ae,[e("div",Be,[t[17]||(t[17]=e("h3",null,"Info",-1)),e("dl",Ue,[t[11]||(t[11]=e("dt",null,"ID",-1)),e("dd",null,h(a.value.id),1),t[12]||(t[12]=e("dt",null,"Size",-1)),e("dd",null,h(a.value.width)+" x "+h(a.value.height),1),t[13]||(t[13]=e("dt",null,"File size",-1)),e("dd",null,h(E(a.value.fileSize)),1),t[14]||(t[14]=e("dt",null,"Type",-1)),e("dd",null,h(a.value.extension),1),t[15]||(t[15]=e("dt",null,"Uploaded",-1)),e("dd",null,h(z(a.value.createdAt)),1),t[16]||(t[16]=e("dt",null,"Rating",-1)),e("dd",qe,[e("button",{class:P(["safety-btn safe",{active:a.value.safety==="safe"}]),onClick:t[0]||(t[0]=r=>l("safe")),title:"Safe"},null,2),e("button",{class:P(["safety-btn sketchy",{active:a.value.safety==="sketchy"}]),onClick:t[1]||(t[1]=r=>l("sketchy")),title:"Sketchy"},null,2),e("button",{class:P(["safety-btn unsafe",{active:a.value.safety==="unsafe"}]),onClick:t[2]||(t[2]=r=>l("unsafe")),title:"Unsafe"},null,2)])])]),e("div",Ne,[t[18]||(t[18]=e("h3",null,"Tags",-1)),F(xe,{tags:a.value.tags},null,8,["tags"]),e("button",{class:"btn btn-secondary edit-tags-btn",onClick:t[3]||(t[3]=r=>b.value=!0)}," Edit Tags ")]),e("div",We,[e("button",{class:P(["btn",{"btn-danger":a.value.isFavorited}]),onClick:$},h(a.value.isFavorited?"ðŸ’” Unfavorite":"ðŸ¾ Favorite"),3),e("button",{class:"btn btn-secondary",onClick:t[4]||(t[4]=r=>g.value=!0)}," Add to Pool "),e("button",{class:"btn btn-danger",onClick:I}," Delete ")]),F(Le,{"post-id":a.value.id},null,8,["post-id"])]),b.value?(u(),v("div",{key:0,class:"modal-overlay",onClick:t[7]||(t[7]=M(r=>b.value=!1,["self"]))},[e("div",Ze,[t[19]||(t[19]=e("h2",null,"Edit Tags",-1)),F(fe,{modelValue:f.value,"onUpdate:modelValue":t[5]||(t[5]=r=>f.value=r)},null,8,["modelValue"]),e("div",je,[e("button",{class:"btn btn-secondary",onClick:t[6]||(t[6]=r=>b.value=!1)},"Cancel"),e("button",{class:"btn",onClick:k},"Save")])])])):S("",!0),g.value?(u(),v("div",{key:1,class:"modal-overlay",onClick:t[10]||(t[10]=M(r=>g.value=!1,["self"]))},[e("div",He,[t[21]||(t[21]=e("h2",null,"Add to Pool",-1)),G(e("select",{"onUpdate:modelValue":t[8]||(t[8]=r=>c.value=r),class:"pool-select"},[t[20]||(t[20]=e("option",{value:""},"Select a pool...",-1)),(u(!0),v(U,null,q(i.value,r=>(u(),v("option",{key:r.id,value:r.id},h(r.name),9,Ke))),128))],512),[[de,c.value]]),e("div",Oe,[e("button",{class:"btn btn-secondary",onClick:t[9]||(t[9]=r=>g.value=!1)},"Cancel"),e("button",{class:"btn",onClick:V,disabled:!c.value},"Add",8,Ge)])])])):S("",!0)])):p.value?(u(),v("div",Je,"Loading...")):(u(),v("div",Qe,"Post not found"))}},ot=X(et,[["__scopeId","data-v-4ac327e7"]]);export{ot as default};
